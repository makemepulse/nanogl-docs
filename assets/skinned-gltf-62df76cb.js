import{C as M,P as C}from"./index-099e42fb.js";import{G as F,a as A}from"./indexbuffer-5b89fc58.js";import{_ as G}from"./web-4702fa01.js";import{L as P,I as S}from"./Ibl-f425c70a.js";import{iblSh as T,iblPath as L}from"./iblData-2ac082dd.js";import{T as O}from"./texture-2d-53b1df66.js";import{f as _}from"./vec3-33249e24.js";import"./arraybuffer-7f1df196.js";import"./ShaderVersion-8538814c.js";import"./Bounds-f9785a14.js";import"./common-a066d304.js";const N=b=>{let m=!1;const i=b||document.getElementById("canvas"),e=i.getContext("webgl"),n={width:1,height:1},p=window.devicePixelRatio,v=([o])=>{const a=o.contentRect.width,B=o.contentRect.height;i.width=Math.round(a*p),i.height=Math.round(B*p),n.width=e.drawingBufferWidth,n.height=e.drawingBufferHeight},f=new ResizeObserver(v);f.observe(i);const s=F.get(e),R=new A().enableDepthTest().enableCullface().cullFace(e.BACK);s.push(R);const g=_(0,1,0),t=new M(new C);t.lens.setAutoFov(35*(Math.PI/180)),t.lens.near=.01,t.lens.far=50,t.position.set([0,4,10]),t.lookAt(g);const l=new P;l.bounds.fromMinMax([-1,-1,-1],[1,1,1]);const d=new O(e,e.RGBA);d.clamp();const c=new S(d,T);c.iblFormat="OCTA",c.shFormat="SH9",c.hdrEncoding="RGBM";const h=new Image;h.src=L,h.onload=()=>{d.fromImage(h)},l.add(c);let r=null;G.loadGltf("../models/BrainStem.gltf").then(async o=>{r=o,await r.allocate(e);for(const a of r.materials)a.materialPass.setLightSetup(l);m=!0,w()});const I=o=>{t.x=Math.sin(o*5e-4)*10,t.z=Math.cos(o*5e-4)*10,t.lookAt(g),t.invalidate()},x=(o=0)=>{for(const a of r.animations)a.evaluate(o%a.duration);r.root.updateWorldMatrix()};let u=null;const w=(o=0)=>{if(m){x(o*5e-4),e.viewport(0,0,n.width,n.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),s.apply(),I(o),t.updateWorldMatrix(),t.updateViewProjectionMatrix(n.width,n.height),l.prepare(e);for(const a of r.renderables)a.render(e,t,1,"color");u=window.requestAnimationFrame(w)}};return()=>{m=!1,window.cancelAnimationFrame(u),f.disconnect(),s.pop(),s.apply()}};export{N as preview};
