import{B as g,g as tt,i as st}from"./arraybuffer-7f1df196.js";const et=51,j=new Float32Array(1),it=new Uint32Array(j.buffer),J=[1,512,1024,1024,2048,4096,4096,4,8192,2,16384,32768,256,65536,65536,65536,262144,131072,131072,131072,524288,524288,524288,2097152,1048576,1048576,1048576,128,4194304,4194304,4194304,4194304,8,16,8388608,8388608,32,64,16777216,33554432,67108864,67108864,67108864,67108864,134217728,134217728,134217728,134217728,268435456,268435456,536870912],at=935847839,ht=new Uint16Array([0,32774,0,1,0,0,0,0,513,0,1029,2305,0,519,0,65535,65535,7680,7680,7680,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,15,1,0,0,0,0,0,0,0,0,y(0),y(1),f(1)]);function N(r){return r|(r&4096)>>>2|(r&2048)>>>2|(r&524288)>>>3|(r&1048576)>>>3|(r&2097152)>>>3}function y(r){return Math.round(r*65535)|0}function Z(r){return r/65535}function o(r){var t=(r&31744)>>10,e=r&1023;return(r>>15?-1:1)*(t?t===31?e?NaN:1/0:Math.pow(2,t-15)*(1+e/1024):6103515625e-14*(e/1024))}function f(r){j[0]=r;const t=it[0];let e=t>>31<<5,s=t>>23&255;return s=s-112&112-s>>4>>27,e=(e|s)<<10,e|=t>>13&1023,e}function a(r,t){return r.getParameter(t)}class p{constructor(){this._dat=new Uint16Array(51),this._set=0}static encodeHalf(t){return f(t)}static decodeHalf(t){return o(t)}toDefault(){this._dat.set(ht),this._set=at|0}clone(){const t=new p;return t._dat.set(this._dat),t._set=this._set,t}patch(t,e){var s=this._dat,i=this._set,n=t._dat,c=t._set,h=e._dat,b=0,_;h.set(n);for(var d=0;d<51;d++)_=J[d],i&_&&((!(c&_)||s[d]!==n[d])&&(b|=_,h[d]=s[d]),c|=_,n[d]=s[d]);t._set=N(c),e._set=N(b)}setupGL(t){const e=this._set,s=this._dat;let i;if(e&1&&(s[0]?t.enable(3042):t.disable(3042)),i=e&2560,i!==0&&(i===2560?t.blendEquationSeparate(s[1],s[4]):t.blendEquation(s[1])),i=e&5120,i!==0&&(i===5120?t.blendFuncSeparate(s[3],s[2],s[6],s[5]):t.blendFunc(s[3],s[2])),e&4&&(s[7]?t.enable(2929):t.disable(2929)),e&8192&&t.depthFunc(s[8]),e&2&&(s[9]?t.enable(2884):t.disable(2884)),e&16384&&t.cullFace(s[10]),e&32768&&t.frontFace(s[11]),e&536870912&&t.lineWidth(o(s[50])),e&256&&(s[12]?t.enable(2960):t.disable(2960)),i=e&589824,i!==0&&(i===589824?(t.stencilFuncSeparate(1028,s[13],s[14],s[15]),t.stencilFuncSeparate(1029,s[20],s[21],s[22])):t.stencilFunc(s[13],s[14],s[15])),i=e&1179648,i!==0&&(i===1179648?(t.stencilOpSeparate(1028,s[17],s[18],s[19]),t.stencilOpSeparate(1029,s[24],s[25],s[26])):t.stencilOp(s[17],s[18],s[19])),i=e&2359296,i!==0&&(i===2359296?(t.stencilMaskSeparate(1028,s[16]),t.stencilMaskSeparate(1029,s[23])):t.stencilMask(s[16])),e&16777216){var n=s[38];t.colorMask((n&1)===1,(n&2)===2,(n&4)===4,(n&8)===8)}e&33554432&&t.depthMask(s[39]===1),e&67108864&&t.blendColor(o(s[40]),o(s[41]),o(s[42]),o(s[43])),e&128&&(s[27]?t.enable(3089):t.disable(3089)),e&4194304&&t.scissor(s[28],s[29],s[30],s[31]),e&134217728&&t.viewport(s[44],s[45],s[46],s[47]),e&16&&(s[33]?t.enable(32823):t.disable(32823)),e&8388608&&t.polygonOffset(o(s[34]),o(s[35])),e&268435456&&t.depthRange(Z(s[48]),Z(s[49]))}fromGL(t){this._set=0;const e=a(t,3042),s=a(t,2884),i=a(t,2929),n=a(t,3024),c=a(t,32823),h=a(t,3089),b=a(t,2960),_=a(t,32969),d=a(t,32968),L=a(t,32971),v=a(t,32970),B=a(t,32777),G=a(t,34877),O=a(t,2962),M=a(t,2967),A=a(t,2963),C=a(t,2968),m=a(t,2964),x=a(t,2965),D=a(t,2966),P=a(t,34816),R=a(t,36003),U=a(t,36004),I=a(t,36005),W=a(t,34817),q=a(t,34818),z=a(t,34819),Q=a(t,32824),X=a(t,10752),S=a(t,3088),F=a(t,3107),Y=a(t,2930),k=a(t,32773),w=a(t,2978),H=a(t,2928),$=a(t,2849);this.enableBlend(e),_!==L||d!==v?this.blendFuncSeparate(_,d,L,v):this.blendFunc(_,d),B!==G?this.blendEquationSeparate(B,G):this.blendEquation(B),this.enableStencil(b),O!==P||M!==R||A!==U?this.stencilFuncSeparate(O,M,A,P,R,U):this.stencilFunc(O,M,A),m!==W||x!==q||D!==z?this.stencilOpSeparate(m,x,D,W,q,z):this.stencilOp(m,x,D),C!==I?this.stencilMaskSeparate(C,I):this.stencilMask(C),this.depthFunc(t.getParameter(2932)),this.enableDepthTest(i),this.cullFace(t.getParameter(2885)),this.enableCullface(s),this.frontFace(t.getParameter(2886)),this.enablePolygonOffset(c),this.polygonOffset(Q,X),this.enableScissor(h),this.scissor(S[0],S[1],S[2],S[3]),this.enableDither(n),this.colorMask(F[0],F[1],F[2],F[3]),this.depthMask(Y),this.blendColor(k[0],k[1],k[2],k[3]),this.viewport(w[0],w[1],w[2],w[3]),this.depthRange(H[0],H[1]),this.lineWidth($)}enableBlend(t=!0){return this._dat[0]=+t,this._set|=1,this}blendFunc(t,e){return this._dat[3]=t,this._dat[2]=e,this._set=this._set&-4097|1024,this}blendFuncSeparate(t,e,s,i){return this._dat[3]=t,this._dat[2]=e,this._dat[6]=s,this._dat[5]=i,this._set|=5120,this}blendEquation(t){return this._dat[1]=t,this._set=this._set&-2049|512,this}blendEquationSeparate(t,e){return this._dat[1]=t,this._dat[4]=e,this._set|=2560,this}blendColor(t,e,s,i){return this._dat[40]=f(t),this._dat[41]=f(e),this._dat[42]=f(s),this._dat[43]=f(i),this._set|=67108864,this}depthFunc(t){return this._dat[8]=t,this._set|=8192,this}enableDepthTest(t=!0){return this._dat[7]=+t,this._set|=4,this}depthRange(t,e){return this._dat[48]=y(t),this._dat[49]=y(e),this._set|=268435456,this}lineWidth(t){return this._dat[50]=f(t),this._set|=536870912,this}cullFace(t){return this._dat[10]=t,this._set|=16384,this}enableCullface(t=!0){return this._dat[9]=+t,this._set|=2,this}polygonOffset(t,e){return this._dat[34]=f(t),this._dat[35]=f(e),this._set|=8388608,this}enablePolygonOffset(t=!0){return this._dat[33]=+t,this._set|=16,this}enableScissor(t=!0){return this._dat[27]=+t,this._set|=128,this}scissor(t,e,s,i){return this._dat[28]=t,this._dat[29]=e,this._dat[30]=s,this._dat[31]=i,this._set|=4194304,this}viewport(t,e,s,i){return this._dat[44]=t,this._dat[45]=e,this._dat[46]=s,this._dat[47]=i,this._set|=134217728,this}enableDither(t=!0){return this._dat[32]=+t,this._set|=8,this}depthMask(t){return this._dat[39]=+t,this._set|=33554432,this}colorMask(t,e,s,i){const n=(t?1:0)|(e?1:0)<<1|(s?1:0)<<2|(i?1:0)<<3;return this._dat[38]=n,this._set|=16777216,this}frontFace(t){return this._dat[11]=t,this._set|=32768,this}enableStencil(t=!0){return this._dat[12]=+t,this._set|=256,this}stencilFunc(t,e,s){return this._dat[13]=t,this._dat[14]=e,this._dat[15]=s,this._set=this._set&-524289|65536,this}stencilOp(t,e,s){return this._dat[17]=t,this._dat[18]=e,this._dat[19]=s,this._set=this._set&-1048577|131072,this}stencilMask(t){return this._dat[16]=t,this._set=this._set&-2097153|262144,this}stencilFuncSeparate(t,e,s,i,n,c){const h=this._dat;return h[13]=t,h[14]=e,h[15]=s,h[20]=i,h[21]=n,h[22]=c,this._set|=589824,this}stencilOpSeparate(t,e,s,i,n,c){const h=this._dat;return h[17]=t,h[18]=e,h[19]=s,h[24]=i,h[25]=n,h[26]=c,this._set|=1179648,this}stencilMaskSeparate(t,e){return this._dat[16]=t,this._dat[23]=e,this._set|=2359296,this}}const E=16,u=et;class nt{constructor(){this._stack=new Uint16Array((u|0)*E|0),this._sets=new Uint32Array(E|0),this._size=E|0,this._ptr=0,this._headPos=0,this._wcfg=new p}initFromGL(t){this._ptr=0,this._wcfg.fromGL(t),this._sets[0]=0,this._stack.set(this._wcfg._dat)}push(t){this._ptr+1===this._size&&this._grow();const e=t._set,s=++this._ptr,i=s*(0|u),n=t._dat,c=this._stack;this._sets[s]=this._sets[s-1]|e;for(var h=0;h<(u|0);h++){var b=J[h],_;e&b?_=n[h]:_=c[i+h-(0|u)],c[i+h]=_}}pop(){const t=--this._ptr;this._headPos>t&&(this._sets[t]|=this._sets[t+1],this._headPos=t)}flush(){for(;this._ptr>0;)this.pop()}commit(t){const e=this._ptr;this.copyConfig(e,t),this._headPos=e,e>0&&(this._sets[e-1]|=this._sets[e]),this._sets[e]=0}copyConfig(t,e){const s=e._dat,i=this._stack,n=0|t*(u|0);for(var c=0;c<(u|0);c++)s[c]=i[n+c];e._set=this._sets[t]}_grow(){const t=this._size<<1,e=new Uint16Array(t*(0|u)),s=new Uint32Array(t);e.set(this._stack,0),s.set(this._sets,0),this._stack=e,this._sets=s,this._size=t}}const V=new p,K=new p;class T{constructor(t){this._state=new p,this.gl=t,this.cfgStack=new nt,this.cfgStack.initFromGL(t),this.cfgStack.copyConfig(0,this._state),this._validCfg=!1}static get(t){let e=this._instances.get(t);return e||(e=new T(t),this._instances.set(t,e)),e}push(t){this.cfgStack.push(t),this._validCfg=!1}pop(){this.cfgStack.pop(),this._validCfg=!1}apply(){this._validCfg||(this.cfgStack.commit(K),K.patch(this._state,V),V.setupGL(this.gl),this._validCfg=!0)}now(t){this.push(t),this.apply(),this.pop()}config(){return new rt(this)}}T._instances=new WeakMap;class rt extends p{constructor(t){super(),this.state=t}apply(){this.state.now(this)}}const l=34963;class _t extends g{constructor(t,e=t.UNSIGNED_SHORT,s,i=t.STATIC_DRAW,n){super(),this.gl=t,this.usage=i,this.buffer=n!==void 0?n:t.createBuffer(),this.type=0,this.typeSize=0,this.byteLength=0,this.setType(e),s&&this.data(s)}bind(){this.gl.bindBuffer(l,this.buffer)}setType(t){this.type=t,this.typeSize=tt(t)}data(t){const e=this.gl;e.bindBuffer(l,this.buffer),e.bufferData(l,t,this.usage),e.bindBuffer(l,null),this.byteLength=st(t)?t.byteLength:t}subData(t,e){const s=this.gl;s.bindBuffer(l,this.buffer),s.bufferSubData(l,e,t),s.bindBuffer(l,null)}dispose(){this.gl.deleteBuffer(this.buffer)}draw(t,e,s=0){e=e===void 0?this.byteLength/this.typeSize:e,this.gl.drawElements(t,e,this.type,0|s)}}export{T as G,_t as I,p as a};
