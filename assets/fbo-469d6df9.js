import{T as c}from"./texture-2d-18ce519d.js";import{i as a}from"./arraybuffer-1b6e50fc.js";let u=0;const r=36161;class o{constructor(t,e,i=0){if(this.samples=0,this._uid=u++,this.gl=t,this.id=t.createRenderbuffer(),i>0&&a(t)){const h=t.getParameter(t.MAX_SAMPLES);this.samples=i>h?h:i}this.width=0,this.height=0,this.format=e||t.DEPTH_COMPONENT16,this._valid=!1,this._storage()}resize(t,e){(this.width!==t||this.height!==e)&&(this.width=t,this.height=e,this._valid=!1)}allocate(){!this._valid&&this.width>0&&this.height>0&&(this._storage(),this._valid=!0)}bind(){this.gl.bindRenderbuffer(r,this.id)}dispose(){this.gl.deleteRenderbuffer(this.id)}_storage(){const t=this.gl;t.bindRenderbuffer(r,this.id),this.samples>0&&a(t)?t.renderbufferStorageMultisample(r,this.samples,this.format,this.width,this.height):t.renderbufferStorage(r,this.format,this.width,this.height),t.bindRenderbuffer(r,null)}}function f(s){return s.id instanceof WebGLTexture}function d(s,t){if(s===null||!f(s))throw new Error(t)}class g{constructor(t){this.target=t,this.level=0,this._isTexture=f(t)}isTexture(){return this._isTexture}_resize(t,e){t>0&&e>0&&(f(this.target)?this.target.fromData(t,e,null):(this.target.resize(t,e),this.target.allocate()))}_attach(t){var e=this.target.gl;this._isTexture?e.framebufferTexture2D(e.FRAMEBUFFER,t,e.TEXTURE_2D,this.target.id,this.level):e.framebufferRenderbuffer(e.FRAMEBUFFER,t,e.RENDERBUFFER,this.target.id)}_detach(t){var e=this.target.gl;this._isTexture?e.framebufferTexture2D(e.FRAMEBUFFER,t,e.TEXTURE_2D,null,this.level):e.framebufferRenderbuffer(e.FRAMEBUFFER,t,e.RENDERBUFFER,null)}dispose(){this.target.dispose()}}class _{constructor(t){this.gl=t,this.width=0,this.height=0,this.fbo=t.createFramebuffer(),this.bind(),this.attachments={},this.attachmentsList=[]}attach(t,e){const i=new g(e);return t=0|t,this.detach(t),this.attachments[t.toString()]=i,this.attachmentsList.push(i),i._resize(this.width,this.height),i._attach(t),i}detach(t){const e=this.attachments[t.toString()];if(e!==void 0){const i=this.attachmentsList.indexOf(e);this.attachmentsList.splice(i,1),e._detach(t)}delete this.attachments[t.toString()]}getAttachment(t){const e=this.attachments[t.toString()];return e!==void 0?e:null}getColor(t=0){const e=this.getAttachment(36064+t);return e?e.target:null}getColorTexture(t=0){const e=this.getColor(t);return d(e,`Color attachment ${t} is not a texture.`),e}getDepth(){const t=this.getAttachment(36096)||this.getAttachment(36128)||this.getAttachment(33306);return t?t.target:null}attachColor(t,e,i){const h=new c(this.gl,t,e,i);return this.attach(36064,h)}attachDepth(t=!0,e=!1,i=!1){let h;if(i){const n=x(this.gl,e);h=new c(this.gl,n.format,n.type,n.internal)}else h=new o(this.gl,E(t,e));return this.attach(m(t,e),h)}resize(t,e){(this.width!==t||this.height!==e)&&(this.width=t|0,this.height=e|0,this._allocate())}bind(){const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.fbo)}clear(){this.gl.clear(17664)}defaultViewport(){this.gl.viewport(0,0,this.width,this.height)}isValid(){const t=this.gl;return t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE}dispose(){this.gl.deleteFramebuffer(this.fbo);for(var e=0;e<this.attachmentsList.length;e++)this.attachmentsList[e].dispose();this.attachmentsList.length=0,this.attachments={}}_allocate(){for(var t of this.attachmentsList)t._resize(this.width,this.height)}}function l(s,t){return s|t<<1}function m(s,t){switch(l(s,t)){case 1:return 36096;case 2:return 36128;case 3:return 33306;default:return 0}}function E(s,t){switch(l(s,t)){case 1:return 33189;case 2:return 36168;case 3:return 34041;default:return 0}}function x(s,t){return t?{format:34041,type:34042,internal:a(s)?s.DEPTH24_STENCIL8:s.DEPTH_STENCIL}:{format:6402,type:5125,internal:a(s)?s.DEPTH_COMPONENT24:s.DEPTH_COMPONENT}}export{_ as F};
