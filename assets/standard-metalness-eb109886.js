import{L as _,I as y,S as H}from"./StandardPass-d78f4231.js";import{C as D,P as G,N as z}from"./index-5809b7fb.js";import{G as W,I as Q}from"./indexbuffer-13597e9e.js";import{M as V,T as j}from"./ShaderPrecision-ccb03460.js";import{T as R}from"./texture-2d-18ce519d.js";import{A as k}from"./arraybuffer-1b6e50fc.js";import{P as q}from"./tweakpane-24b35bd6.js";import{t as K}from"./square-texture-5de1b8a4.js";import{iblSh as X,iblPath as Y}from"./iblData-2ac082dd.js";import{cubePosUvsNormals as J,cubeIndices as Z}from"./cubeGeometry-a8671df7.js";import{c as $}from"./vec3-a79e08f1.js";import"./common-a066d304.js";const ge=O=>{let A=!0;const d=O||document.getElementById("canvas"),t=d.getContext("webgl"),r={width:1,height:1},v=window.devicePixelRatio,U=([c])=>{const n=c.contentRect.width,B=c.contentRect.height;d.width=Math.round(n*v),d.height=Math.round(B*v),r.width=t.drawingBufferWidth,r.height=t.drawingBufferHeight},I=new ResizeObserver(U);I.observe(d);const i=W.get(t),E=$(),s=new D(new G);s.lens.setAutoFov(35*(Math.PI/180)),s.lens.near=.01,s.lens.far=50,s.position.set([0,4,10]),s.lookAt(E);const m=new k(t,new Float32Array(J)),b=new Q(t,t.UNSIGNED_SHORT,new Uint16Array(Z));m.attrib("aPosition",3,t.FLOAT),m.attrib("aTexCoord",2,t.FLOAT),m.attrib("aNormal",3,t.FLOAT);const l=new z,p=new R(t);p.clamp();const w=new Image;w.src=K,w.onload=()=>{p.fromImage(w)};const g=new _;g.bounds.fromMinMax([-1,-1,-1],[1,1,1]);const h=new R(t,t.RGBA);h.clamp();const u=new y(h,X);u.iblFormat="OCTA",u.shFormat="SH9",u.hdrEncoding="RGBM";const C=new Image;C.src=Y,C.onload=()=>{h.fromImage(C)},g.add(u);const e={useTexture:!1,baseColor:{r:.5,g:0,b:.5},metalness:.8,roughness:.2,emissiveColor:{r:0,g:0,b:0},alpha:1,isTransparent:!1},o=new V(t);o.glconfig.enableDepthTest().enableCullface().cullFace(t.BACK).enableBlend().blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA);const a=new H;o.addPass(a),a.setLightSetup(g),a.surface.metalness.attachUniform("metalness",1).set(e.metalness),a.surface.roughness.attachUniform("roughness",1).set(e.roughness),a.emissive.attachUniform("emissive",3).set(e.emissiveColor.r,e.emissiveColor.g,e.emissiveColor.b),a.alpha.attachUniform("alpha",1).set(e.alpha),a.alphaMode.set("OPAQUE");const P=()=>{a.surface.baseColor.attachUniform("color",3).set(e.baseColor.r,e.baseColor.g,e.baseColor.b)},L=()=>{a.surface.baseColor.attachSampler("color",j.create("aTexCoord")).set(p)};P();const N=()=>{l.rotateY(-.005),l.rotateX(.005),l.invalidate(),l.updateWorldMatrix()};let S=null;const F=(c=0)=>{if(!A)return;t.viewport(0,0,r.width,r.height),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),o.glconfig&&i.push(o.glconfig),i.apply(),N(),s.updateWorldMatrix(),s.updateViewProjectionMatrix(r.width,r.height),g.prepare(t),o.getAllPasses().forEach(B=>{B.prepare(l,s)});const n=o.getProgram("color");m.attribPointer(n),b.bind(),b.drawTriangles(),o.glconfig&&i.pop(),S=window.requestAnimationFrame(F)};setTimeout(F,0);const T=new q({container:document.getElementById("debug")}),f=T.addFolder({title:"Metalness"}),x=T.addFolder({title:"Standard"}),M=(c,n)=>{c.set(n.r,n.g,n.b)};return f.addBinding(e,"useTexture").on("change",()=>{e.useTexture?L():P()}),f.addBinding(e,"baseColor",{color:{type:"float"}}).on("change",()=>{e.useTexture||M(a.surface.baseColor.param,e.baseColor)}),f.addBinding(e,"metalness",{min:0,max:1,step:.1}).on("change",()=>a.surface.metalness.param.set(e.metalness)),f.addBinding(e,"roughness",{min:0,max:1,step:.1}).on("change",()=>a.surface.roughness.param.set(e.roughness)),x.addBinding(e,"emissiveColor",{color:{type:"float"}}).on("change",()=>M(a.emissive.param,e.emissiveColor)),x.addBinding(e,"isTransparent").on("change",()=>{a.alphaMode.set(e.isTransparent?"BLEND":"OPAQUE")}),x.addBinding(e,"alpha",{min:0,max:1,step:.1}).on("change",()=>a.alpha.param.set(e.alpha)),()=>{A=!1,window.cancelAnimationFrame(S),I.disconnect(),T.dispose(),p.dispose(),b.dispose(),h.dispose(),i.pop(),i.apply()}};export{ge as preview};
