import{L as y,I as _,a as H}from"./StandardPass-d78f4231.js";import{C as D,P as G,N as z}from"./index-5809b7fb.js";import{G as W,I as j}from"./indexbuffer-13597e9e.js";import{M as q,T as Q}from"./ShaderPrecision-ccb03460.js";import{T as M}from"./texture-2d-18ce519d.js";import{A as V}from"./arraybuffer-1b6e50fc.js";import{P as k}from"./tweakpane-24b35bd6.js";import{iblSh as K,iblPath as X}from"./iblData-c0d0c1f1.js";import{cubePosUvsNormals as Y,cubeIndices as J}from"./cubeGeometry-a8671df7.js";import{c as Z}from"./vec3-a79e08f1.js";import"./common-a066d304.js";const pe=O=>{let v=!0;const d=O||document.getElementById("canvas"),a=d.getContext("webgl"),n={width:1,height:1},I=window.devicePixelRatio,U=([c])=>{const r=c.contentRect.width,A=c.contentRect.height;d.width=Math.round(r*I),d.height=Math.round(A*I),n.width=a.drawingBufferWidth,n.height=a.drawingBufferHeight},P=new ResizeObserver(U);P.observe(d);const i=W.get(a),E=Z(),s=new D(new G);s.lens.setAutoFov(35*(Math.PI/180)),s.lens.near=.01,s.lens.far=50,s.position.set([0,4,10]),s.lookAt(E);const p=new V(a,new Float32Array(Y)),b=new j(a,a.UNSIGNED_SHORT,new Uint16Array(J));p.attrib("aPosition",3,a.FLOAT),p.attrib("aTexCoord",2,a.FLOAT),p.attrib("aNormal",3,a.FLOAT);const l=new z,m=new M(a);m.clamp();const w=new Image;w.src="/images/square-texture.jpg",w.onload=()=>{m.fromImage(w)};const g=new y;g.bounds.fromMinMax([-1,-1,-1],[1,1,1]);const u=new M(a,a.RGBA);u.clamp();const h=new _(u,K);h.iblFormat="OCTA",h.shFormat="SH9",h.hdrEncoding="RGBM";const C=new Image;C.src=X,C.onload=()=>{u.fromImage(C)},g.add(h);const e={useTexture:!1,baseColor:{r:.5,g:0,b:.5},specularColor:{r:0,g:0,b:.5},emissiveColor:{r:0,g:0,b:0},glossiness:.8,alpha:1,isTransparent:!1},t=new q(a);t.glconfig.enableDepthTest().enableCullface().cullFace(a.BACK).enableBlend().blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);const o=new H;t.addPass(o),o.setLightSetup(g),o.surface.specular.attachUniform("specular",3).set(e.specularColor.r,e.specularColor.g,e.specularColor.b),o.surface.glossiness.attachUniform("glossiness",1).set(e.glossiness),o.emissive.attachUniform("emissive",3).set(e.emissiveColor.r,e.emissiveColor.g,e.emissiveColor.b),o.alpha.attachUniform("alpha",1).set(e.alpha),o.alphaMode.set("OPAQUE");const S=()=>{o.surface.baseColor.attachUniform("color",3).set(e.baseColor.r,e.baseColor.g,e.baseColor.b)},L=()=>{o.surface.baseColor.attachSampler("color",Q.create("aTexCoord")).set(m)};S();const N=()=>{l.rotateY(-.005),l.rotateX(.005),l.invalidate(),l.updateWorldMatrix()};let F=null;const R=(c=0)=>{if(!v)return;a.viewport(0,0,n.width,n.height),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),t.glconfig&&i.push(t.glconfig),i.apply(),N(),s.updateWorldMatrix(),s.updateViewProjectionMatrix(n.width,n.height),g.prepare(a),t.getAllPasses().forEach(A=>{A.prepare(l,s)});const r=t.getProgram("color");p.attribPointer(r),b.bind(),b.drawTriangles(),t.glconfig&&i.pop(),F=window.requestAnimationFrame(R)};setTimeout(R,0);const T=new k({container:document.getElementById("debug")}),f=T.addFolder({title:"Specular"}),B=T.addFolder({title:"Standard"}),x=(c,r)=>{c.set(r.r,r.g,r.b)};return f.addBinding(e,"useTexture").on("change",()=>{e.useTexture?L():S()}),f.addBinding(e,"baseColor",{color:{type:"float"}}).on("change",()=>{e.useTexture||x(o.surface.baseColor.param,e.baseColor)}),f.addBinding(e,"specularColor",{color:{type:"float"}}).on("change",()=>x(o.surface.specular.param,e.specularColor)),f.addBinding(e,"glossiness",{min:0,max:1,step:.1}).on("change",()=>o.surface.glossiness.param.set(e.glossiness)),B.addBinding(e,"emissiveColor",{color:{type:"float"}}).on("change",()=>x(o.emissive.param,e.emissiveColor)),B.addBinding(e,"isTransparent").on("change",()=>{o.alphaMode.set(e.isTransparent?"BLEND":"OPAQUE")}),B.addBinding(e,"alpha",{min:0,max:1,step:.1}).on("change",()=>o.alpha.param.set(e.alpha)),()=>{v=!1,window.cancelAnimationFrame(F),P.disconnect(),T.dispose(),m.dispose(),b.dispose(),u.dispose(),i.pop(),i.apply()}};export{pe as preview};
