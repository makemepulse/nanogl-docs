import{C as M,P as C}from"./index-099e42fb.js";import{G as F,a as A}from"./indexbuffer-5b89fc58.js";import{_ as G}from"./web-4702fa01.js";import{L as P,I as S}from"./Ibl-f425c70a.js";import{iblSh as T,iblPath as L}from"./iblData-2ac082dd.js";import{T as O}from"./texture-2d-53b1df66.js";import{f as _}from"./vec3-33249e24.js";import"./arraybuffer-7f1df196.js";import"./ShaderVersion-8538814c.js";import"./Bounds-f9785a14.js";import"./common-a066d304.js";const N=b=>{let m=!1;const i=b||document.getElementById("canvas"),e=i.getContext("webgl"),n={width:1,height:1},p=window.devicePixelRatio,v=([a])=>{const o=a.contentRect.width,B=a.contentRect.height;i.width=Math.round(o*p),i.height=Math.round(B*p),n.width=e.drawingBufferWidth,n.height=e.drawingBufferHeight},f=new ResizeObserver(v);f.observe(i);const s=F.get(e),R=new A().enableDepthTest().enableCullface().cullFace(e.BACK);s.push(R);const g=_(0,1,0),t=new M(new C);t.lens.setAutoFov(35*(Math.PI/180)),t.lens.near=.01,t.lens.far=50,t.position.set([0,4,10]),t.lookAt(g);const l=new P;l.bounds.fromMinMax([-1,-1,-1],[1,1,1]);const d=new O(e,e.RGBA);d.clamp();const c=new S(d,T);c.iblFormat="OCTA",c.shFormat="SH9",c.hdrEncoding="RGBM";const h=new Image;h.src=L,h.onload=()=>{d.fromImage(h)},l.add(c);let r=null;G.loadGltf("/src/assets/webgl/models/BrainStem.gltf").then(async a=>{r=a,await r.allocate(e);for(const o of r.materials)o.materialPass.setLightSetup(l);m=!0,u()});const I=a=>{t.x=Math.sin(a*5e-4)*10,t.z=Math.cos(a*5e-4)*10,t.lookAt(g),t.invalidate()},x=(a=0)=>{for(const o of r.animations)o.evaluate(a%o.duration);r.root.updateWorldMatrix()};let w=null;const u=(a=0)=>{if(m){x(a*5e-4),e.viewport(0,0,n.width,n.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),s.apply(),I(a),t.updateWorldMatrix(),t.updateViewProjectionMatrix(n.width,n.height),l.prepare(e);for(const o of r.renderables)o.render(e,t,1,"color");w=window.requestAnimationFrame(u)}};return()=>{m=!1,window.cancelAnimationFrame(w),f.disconnect(),s.pop(),s.apply()}};export{N as preview};
