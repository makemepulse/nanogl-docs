import{C as B,P as C}from"./index-099e42fb.js";import{G as F,a as M}from"./indexbuffer-5b89fc58.js";import{_ as A}from"./web-4702fa01.js";import{L as G,I as P}from"./Ibl-f425c70a.js";import{iblSh as T,iblPath as L}from"./iblData-2ac082dd.js";import{T as S}from"./texture-2d-53b1df66.js";import{c as O}from"./vec3-33249e24.js";import"./arraybuffer-7f1df196.js";import"./ShaderVersion-8538814c.js";import"./Bounds-f9785a14.js";import"./common-a066d304.js";const N=u=>{let d=!1;const i=u||document.getElementById("canvas"),e=i.getContext("webgl"),n={width:1,height:1},p=window.devicePixelRatio,b=([o])=>{const a=o.contentRect.width,x=o.contentRect.height;i.width=Math.round(a*p),i.height=Math.round(x*p),n.width=e.drawingBufferWidth,n.height=e.drawingBufferHeight},f=new ResizeObserver(b);f.observe(i);const s=F.get(e),v=new M().enableDepthTest().enableCullface().cullFace(e.BACK);s.push(v);const R=O(),t=new B(new C);t.lens.setAutoFov(35*(Math.PI/180)),t.lens.near=.01,t.lens.far=50,t.position.set([-6,4,10]),t.lookAt(R);const l=new G;l.bounds.fromMinMax([-1,-1,-1],[1,1,1]);const m=new S(e,e.RGBA);m.clamp();const c=new P(m,T);c.iblFormat="OCTA",c.shFormat="SH9",c.hdrEncoding="RGBM";const h=new Image;h.src=L,h.onload=()=>{m.fromImage(h)},l.add(c);let r=null;A.loadGltf("/src/assets/webgl/models/AnimatedMorphCube.glb").then(async o=>{r=o,await r.allocate(e);for(const a of r.materials)a.materialPass.setLightSetup(l);d=!0,w()});const I=(o=0)=>{for(const a of r.animations)a.evaluate(o%a.duration);r.root.updateWorldMatrix()};let g=null;const w=(o=0)=>{if(d){I(o*5e-4),e.viewport(0,0,n.width,n.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),s.apply(),t.updateWorldMatrix(),t.updateViewProjectionMatrix(n.width,n.height),l.prepare(e);for(const a of r.renderables)a.render(e,t,1,"color");g=window.requestAnimationFrame(w)}};return()=>{d=!1,window.cancelAnimationFrame(g),f.disconnect(),s.pop(),s.apply()}};export{N as preview};
