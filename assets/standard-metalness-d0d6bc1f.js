import{L as _,I as y,S as H}from"./StandardPass-d78f4231.js";import{C as D,P as G,N as z}from"./index-5809b7fb.js";import{G as W,I as j}from"./indexbuffer-13597e9e.js";import{M as q,T as Q}from"./ShaderPrecision-ccb03460.js";import{T as S}from"./texture-2d-18ce519d.js";import{A as V}from"./arraybuffer-1b6e50fc.js";import{P as k}from"./tweakpane-24b35bd6.js";import{iblSh as K,iblPath as X}from"./iblData-c0d0c1f1.js";import{cubePosUvsNormals as Y,cubeIndices as J}from"./cubeGeometry-a8671df7.js";import{c as Z}from"./vec3-a79e08f1.js";import"./common-a066d304.js";const me=O=>{let A=!0;const d=O||document.getElementById("canvas"),a=d.getContext("webgl"),r={width:1,height:1},v=window.devicePixelRatio,U=([c])=>{const n=c.contentRect.width,B=c.contentRect.height;d.width=Math.round(n*v),d.height=Math.round(B*v),r.width=a.drawingBufferWidth,r.height=a.drawingBufferHeight},I=new ResizeObserver(U);I.observe(d);const i=W.get(a),E=Z(),s=new D(new G);s.lens.setAutoFov(35*(Math.PI/180)),s.lens.near=.01,s.lens.far=50,s.position.set([0,4,10]),s.lookAt(E);const m=new V(a,new Float32Array(Y)),b=new j(a,a.UNSIGNED_SHORT,new Uint16Array(J));m.attrib("aPosition",3,a.FLOAT),m.attrib("aTexCoord",2,a.FLOAT),m.attrib("aNormal",3,a.FLOAT);const l=new z,p=new S(a);p.clamp();const w=new Image;w.src="/images/square-texture.jpg",w.onload=()=>{p.fromImage(w)};const g=new _;g.bounds.fromMinMax([-1,-1,-1],[1,1,1]);const h=new S(a,a.RGBA);h.clamp();const u=new y(h,K);u.iblFormat="OCTA",u.shFormat="SH9",u.hdrEncoding="RGBM";const C=new Image;C.src=X,C.onload=()=>{h.fromImage(C)},g.add(u);const e={useTexture:!1,baseColor:{r:.5,g:0,b:.5},metalness:.8,roughness:.2,emissiveColor:{r:0,g:0,b:0},alpha:1,isTransparent:!1},o=new q(a);o.glconfig.enableDepthTest().enableCullface().cullFace(a.BACK).enableBlend().blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);const t=new H;o.addPass(t),t.setLightSetup(g),t.surface.metalness.attachUniform("metalness",1).set(e.metalness),t.surface.roughness.attachUniform("roughness",1).set(e.roughness),t.emissive.attachUniform("emissive",3).set(e.emissiveColor.r,e.emissiveColor.g,e.emissiveColor.b),t.alpha.attachUniform("alpha",1).set(e.alpha),t.alphaMode.set("OPAQUE");const P=()=>{t.surface.baseColor.attachUniform("color",3).set(e.baseColor.r,e.baseColor.g,e.baseColor.b)},L=()=>{t.surface.baseColor.attachSampler("color",Q.create("aTexCoord")).set(p)};P();const N=()=>{l.rotateY(-.005),l.rotateX(.005),l.invalidate(),l.updateWorldMatrix()};let F=null;const M=(c=0)=>{if(!A)return;a.viewport(0,0,r.width,r.height),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),o.glconfig&&i.push(o.glconfig),i.apply(),N(),s.updateWorldMatrix(),s.updateViewProjectionMatrix(r.width,r.height),g.prepare(a),o.getAllPasses().forEach(B=>{B.prepare(l,s)});const n=o.getProgram("color");m.attribPointer(n),b.bind(),b.drawTriangles(),o.glconfig&&i.pop(),F=window.requestAnimationFrame(M)};setTimeout(M,0);const T=new k({container:document.getElementById("debug")}),f=T.addFolder({title:"Metalness"}),x=T.addFolder({title:"Standard"}),R=(c,n)=>{c.set(n.r,n.g,n.b)};return f.addBinding(e,"useTexture").on("change",()=>{e.useTexture?L():P()}),f.addBinding(e,"baseColor",{color:{type:"float"}}).on("change",()=>{e.useTexture||R(t.surface.baseColor.param,e.baseColor)}),f.addBinding(e,"metalness",{min:0,max:1,step:.1}).on("change",()=>t.surface.metalness.param.set(e.metalness)),f.addBinding(e,"roughness",{min:0,max:1,step:.1}).on("change",()=>t.surface.roughness.param.set(e.roughness)),x.addBinding(e,"emissiveColor",{color:{type:"float"}}).on("change",()=>R(t.emissive.param,e.emissiveColor)),x.addBinding(e,"isTransparent").on("change",()=>{t.alphaMode.set(e.isTransparent?"BLEND":"OPAQUE")}),x.addBinding(e,"alpha",{min:0,max:1,step:.1}).on("change",()=>t.alpha.param.set(e.alpha)),()=>{A=!1,window.cancelAnimationFrame(F),I.disconnect(),T.dispose(),p.dispose(),b.dispose(),h.dispose(),i.pop(),i.apply()}};export{me as preview};
