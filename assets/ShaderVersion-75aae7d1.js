import{a as $n}from"./indexbuffer-5b89fc58.js";import{P as Vn,a as Un}from"./arraybuffer-7f1df196.js";class B{constructor(r=!1,e=!1){this._ref=null,this._lists=new Set,this._hasCode=r,this._hasSetup=e,this._invalid=!0,this._children=[]}collectChunks(r,e){if(r.add(this),this._ref!==null)this._ref.collectChunks(r,e);else{for(const s of this._children)s.collectChunks(r,e);e.add(this)}}detectCyclicDependency(r){const e=new Set,s=new Set;return r.collectChunks(e,s),e.has(this)}addChild(r){if(this._children.indexOf(r)>-1)return r;if(this.detectCyclicDependency(r))throw new Error("Chunk.addChild() will lead to cyclic dependency");return this._children.push(r),this.invalidateList(),r}removeChild(r){var e=this._children.indexOf(r);e>-1&&this._children.splice(e,1),this.invalidateList()}genCode(r){this._ref!==null?this._ref.genCode(r):this._genCode(r)}get hasCode(){return this._ref!==null?this._ref.hasCode:this._hasCode}get hasSetup(){return this._ref!==null?this._ref.hasSetup:this._hasSetup}get isInvalid(){return this._ref!==null?this._ref.isInvalid:this._invalid}setup(r){}addList(r){this._lists.add(r)}removeList(r){this._lists.delete(r)}invalidateList(){for(const r of this._lists.values())r.invalidateList()}invalidateCode(){for(const r of this._lists.values())r.invalidateCode()}proxy(r=null){if(this._ref!==r){if(r!==null&&this.detectCyclicDependency(r))throw new Error("Chunk.proxy() will lead to cyclic dependency");this._ref=r,this.invalidateList()}}createProxy(){const r=B,e=new r;return e.proxy(this),e}}function Fn(n,r,e){return n+=`#define ${r} ${e+1}
`,n}class pr extends B{constructor(r,e){super(!0,!1),this.name=r,this.values=e,this._valIndex=0,this._val=this.values[0],this._enumDefs=this.values.reduce(Fn,""),this._accesDef=`#define ${this.name}(k) VAL_${this.name} == k`}value(){return this._val}set(r){if(this._val===r)return;const e=this.values.indexOf(r);if(e===-1)throw new Error(`invalide Enum value :${r}`);this._valIndex!==e&&(this._valIndex=e,this._val=r,this.invalidateCode())}_genCode(r){const e=[this._enumDefs,`#define VAL_${this.name} ${this._val}`,this._accesDef].join(`
`);r.add("definitions",e)}}var J={};J.EPSILON=1e-6;J.ARRAY_TYPE=typeof Float32Array<"u"?Float32Array:Array;J.RANDOM=Math.random;J.setMatrixArrayType=function(n){GLMAT_ARRAY_TYPE=n};var Gn=Math.PI/180;J.toRadian=function(n){return n*Gn};var X=J,En=X,O={};O.create=function(){var n=new En.ARRAY_TYPE(4);return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n};O.clone=function(n){var r=new En.ARRAY_TYPE(4);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r};O.copy=function(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n};O.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n};O.transpose=function(n,r){if(n===r){var e=r[1];n[1]=r[2],n[2]=e}else n[0]=r[0],n[1]=r[2],n[2]=r[1],n[3]=r[3];return n};O.invert=function(n,r){var e=r[0],s=r[1],i=r[2],t=r[3],h=e*t-i*s;return h?(h=1/h,n[0]=t*h,n[1]=-s*h,n[2]=-i*h,n[3]=e*h,n):null};O.adjoint=function(n,r){var e=r[0];return n[0]=r[3],n[1]=-r[1],n[2]=-r[2],n[3]=e,n};O.determinant=function(n){return n[0]*n[3]-n[2]*n[1]};O.multiply=function(n,r,e){var s=r[0],i=r[1],t=r[2],h=r[3],c=e[0],a=e[1],f=e[2],l=e[3];return n[0]=s*c+t*a,n[1]=i*c+h*a,n[2]=s*f+t*l,n[3]=i*f+h*l,n};O.mul=O.multiply;O.rotate=function(n,r,e){var s=r[0],i=r[1],t=r[2],h=r[3],c=Math.sin(e),a=Math.cos(e);return n[0]=s*a+t*c,n[1]=i*a+h*c,n[2]=s*-c+t*a,n[3]=i*-c+h*a,n};O.scale=function(n,r,e){var s=r[0],i=r[1],t=r[2],h=r[3],c=e[0],a=e[1];return n[0]=s*c,n[1]=i*c,n[2]=t*a,n[3]=h*a,n};O.fromRotation=function(n,r){var e=Math.sin(r),s=Math.cos(r);return n[0]=s,n[1]=e,n[2]=-e,n[3]=s,n};O.fromScaling=function(n,r){return n[0]=r[0],n[1]=0,n[2]=0,n[3]=r[1],n};O.str=function(n){return"mat2("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"};O.frob=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)+Math.pow(n[3],2))};O.LDU=function(n,r,e,s){return n[2]=s[2]/s[0],e[0]=s[0],e[1]=s[1],e[3]=s[3]-n[2]*e[1],[n,r,e]};var Ln=X,q={};q.create=function(){var n=new Ln.ARRAY_TYPE(6);return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n};q.clone=function(n){var r=new Ln.ARRAY_TYPE(6);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r};q.copy=function(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n};q.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n};q.invert=function(n,r){var e=r[0],s=r[1],i=r[2],t=r[3],h=r[4],c=r[5],a=e*t-s*i;return a?(a=1/a,n[0]=t*a,n[1]=-s*a,n[2]=-i*a,n[3]=e*a,n[4]=(i*c-t*h)*a,n[5]=(s*h-e*c)*a,n):null};q.determinant=function(n){return n[0]*n[3]-n[1]*n[2]};q.multiply=function(n,r,e){var s=r[0],i=r[1],t=r[2],h=r[3],c=r[4],a=r[5],f=e[0],l=e[1],v=e[2],d=e[3],_=e[4],p=e[5];return n[0]=s*f+t*l,n[1]=i*f+h*l,n[2]=s*v+t*d,n[3]=i*v+h*d,n[4]=s*_+t*p+c,n[5]=i*_+h*p+a,n};q.mul=q.multiply;q.rotate=function(n,r,e){var s=r[0],i=r[1],t=r[2],h=r[3],c=r[4],a=r[5],f=Math.sin(e),l=Math.cos(e);return n[0]=s*l+t*f,n[1]=i*l+h*f,n[2]=s*-f+t*l,n[3]=i*-f+h*l,n[4]=c,n[5]=a,n};q.scale=function(n,r,e){var s=r[0],i=r[1],t=r[2],h=r[3],c=r[4],a=r[5],f=e[0],l=e[1];return n[0]=s*f,n[1]=i*f,n[2]=t*l,n[3]=h*l,n[4]=c,n[5]=a,n};q.translate=function(n,r,e){var s=r[0],i=r[1],t=r[2],h=r[3],c=r[4],a=r[5],f=e[0],l=e[1];return n[0]=s,n[1]=i,n[2]=t,n[3]=h,n[4]=s*f+t*l+c,n[5]=i*f+h*l+a,n};q.fromRotation=function(n,r){var e=Math.sin(r),s=Math.cos(r);return n[0]=s,n[1]=e,n[2]=-e,n[3]=s,n[4]=0,n[5]=0,n};q.fromScaling=function(n,r){return n[0]=r[0],n[1]=0,n[2]=0,n[3]=r[1],n[4]=0,n[5]=0,n};q.fromTranslation=function(n,r){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=r[0],n[5]=r[1],n};q.str=function(n){return"mat2d("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+")"};q.frob=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)+Math.pow(n[3],2)+Math.pow(n[4],2)+Math.pow(n[5],2)+1)};var In=X,L={};L.create=function(){var n=new In.ARRAY_TYPE(9);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n};L.fromMat4=function(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[4],n[4]=r[5],n[5]=r[6],n[6]=r[8],n[7]=r[9],n[8]=r[10],n};L.clone=function(n){var r=new In.ARRAY_TYPE(9);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r};L.copy=function(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n};L.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n};L.transpose=function(n,r){if(n===r){var e=r[1],s=r[2],i=r[5];n[1]=r[3],n[2]=r[6],n[3]=e,n[5]=r[7],n[6]=s,n[7]=i}else n[0]=r[0],n[1]=r[3],n[2]=r[6],n[3]=r[1],n[4]=r[4],n[5]=r[7],n[6]=r[2],n[7]=r[5],n[8]=r[8];return n};L.invert=function(n,r){var e=r[0],s=r[1],i=r[2],t=r[3],h=r[4],c=r[5],a=r[6],f=r[7],l=r[8],v=l*h-c*f,d=-l*t+c*a,_=f*t-h*a,p=e*v+s*d+i*_;return p?(p=1/p,n[0]=v*p,n[1]=(-l*s+i*f)*p,n[2]=(c*s-i*h)*p,n[3]=d*p,n[4]=(l*e-i*a)*p,n[5]=(-c*e+i*t)*p,n[6]=_*p,n[7]=(-f*e+s*a)*p,n[8]=(h*e-s*t)*p,n):null};L.adjoint=function(n,r){var e=r[0],s=r[1],i=r[2],t=r[3],h=r[4],c=r[5],a=r[6],f=r[7],l=r[8];return n[0]=h*l-c*f,n[1]=i*f-s*l,n[2]=s*c-i*h,n[3]=c*a-t*l,n[4]=e*l-i*a,n[5]=i*t-e*c,n[6]=t*f-h*a,n[7]=s*a-e*f,n[8]=e*h-s*t,n};L.determinant=function(n){var r=n[0],e=n[1],s=n[2],i=n[3],t=n[4],h=n[5],c=n[6],a=n[7],f=n[8];return r*(f*t-h*a)+e*(-f*i+h*c)+s*(a*i-t*c)};L.multiply=function(n,r,e){var s=r[0],i=r[1],t=r[2],h=r[3],c=r[4],a=r[5],f=r[6],l=r[7],v=r[8],d=e[0],_=e[1],p=e[2],M=e[3],g=e[4],m=e[5],S=e[6],w=e[7],x=e[8];return n[0]=d*s+_*h+p*f,n[1]=d*i+_*c+p*l,n[2]=d*t+_*a+p*v,n[3]=M*s+g*h+m*f,n[4]=M*i+g*c+m*l,n[5]=M*t+g*a+m*v,n[6]=S*s+w*h+x*f,n[7]=S*i+w*c+x*l,n[8]=S*t+w*a+x*v,n};L.mul=L.multiply;L.translate=function(n,r,e){var s=r[0],i=r[1],t=r[2],h=r[3],c=r[4],a=r[5],f=r[6],l=r[7],v=r[8],d=e[0],_=e[1];return n[0]=s,n[1]=i,n[2]=t,n[3]=h,n[4]=c,n[5]=a,n[6]=d*s+_*h+f,n[7]=d*i+_*c+l,n[8]=d*t+_*a+v,n};L.rotate=function(n,r,e){var s=r[0],i=r[1],t=r[2],h=r[3],c=r[4],a=r[5],f=r[6],l=r[7],v=r[8],d=Math.sin(e),_=Math.cos(e);return n[0]=_*s+d*h,n[1]=_*i+d*c,n[2]=_*t+d*a,n[3]=_*h-d*s,n[4]=_*c-d*i,n[5]=_*a-d*t,n[6]=f,n[7]=l,n[8]=v,n};L.scale=function(n,r,e){var s=e[0],i=e[1];return n[0]=s*r[0],n[1]=s*r[1],n[2]=s*r[2],n[3]=i*r[3],n[4]=i*r[4],n[5]=i*r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n};L.fromTranslation=function(n,r){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=r[0],n[7]=r[1],n[8]=1,n};L.fromRotation=function(n,r){var e=Math.sin(r),s=Math.cos(r);return n[0]=s,n[1]=e,n[2]=0,n[3]=-e,n[4]=s,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n};L.fromScaling=function(n,r){return n[0]=r[0],n[1]=0,n[2]=0,n[3]=0,n[4]=r[1],n[5]=0,n[6]=0,n[7]=0,n[8]=1,n};L.fromMat2d=function(n,r){return n[0]=r[0],n[1]=r[1],n[2]=0,n[3]=r[2],n[4]=r[3],n[5]=0,n[6]=r[4],n[7]=r[5],n[8]=1,n};L.fromQuat=function(n,r){var e=r[0],s=r[1],i=r[2],t=r[3],h=e+e,c=s+s,a=i+i,f=e*h,l=s*h,v=s*c,d=i*h,_=i*c,p=i*a,M=t*h,g=t*c,m=t*a;return n[0]=1-v-p,n[3]=l-m,n[6]=d+g,n[1]=l+m,n[4]=1-f-p,n[7]=_-M,n[2]=d-g,n[5]=_+M,n[8]=1-f-v,n};L.normalFromMat4=function(n,r){var e=r[0],s=r[1],i=r[2],t=r[3],h=r[4],c=r[5],a=r[6],f=r[7],l=r[8],v=r[9],d=r[10],_=r[11],p=r[12],M=r[13],g=r[14],m=r[15],S=e*c-s*h,w=e*a-i*h,x=e*f-t*h,o=s*a-i*c,A=s*f-t*c,N=i*f-t*a,I=l*M-v*p,P=l*g-d*p,E=l*m-_*p,Y=v*g-d*M,k=v*m-_*M,D=d*m-_*g,T=S*D-w*k+x*Y+o*E-A*P+N*I;return T?(T=1/T,n[0]=(c*D-a*k+f*Y)*T,n[1]=(a*E-h*D-f*P)*T,n[2]=(h*k-c*E+f*I)*T,n[3]=(i*k-s*D-t*Y)*T,n[4]=(e*D-i*E+t*P)*T,n[5]=(s*E-e*k-t*I)*T,n[6]=(M*N-g*A+m*o)*T,n[7]=(g*x-p*N-m*w)*T,n[8]=(p*A-M*x+m*S)*T,n):null};L.str=function(n){return"mat3("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+", "+n[8]+")"};L.frob=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)+Math.pow(n[3],2)+Math.pow(n[4],2)+Math.pow(n[5],2)+Math.pow(n[6],2)+Math.pow(n[7],2)+Math.pow(n[8],2))};var Pn=L,Q=X,$={};$.create=function(){var n=new Q.ARRAY_TYPE(16);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n};$.clone=function(n){var r=new Q.ARRAY_TYPE(16);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],r};$.copy=function(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],n};$.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n};$.transpose=function(n,r){if(n===r){var e=r[1],s=r[2],i=r[3],t=r[6],h=r[7],c=r[11];n[1]=r[4],n[2]=r[8],n[3]=r[12],n[4]=e,n[6]=r[9],n[7]=r[13],n[8]=s,n[9]=t,n[11]=r[14],n[12]=i,n[13]=h,n[14]=c}else n[0]=r[0],n[1]=r[4],n[2]=r[8],n[3]=r[12],n[4]=r[1],n[5]=r[5],n[6]=r[9],n[7]=r[13],n[8]=r[2],n[9]=r[6],n[10]=r[10],n[11]=r[14],n[12]=r[3],n[13]=r[7],n[14]=r[11],n[15]=r[15];return n};$.invert=function(n,r){var e=r[0],s=r[1],i=r[2],t=r[3],h=r[4],c=r[5],a=r[6],f=r[7],l=r[8],v=r[9],d=r[10],_=r[11],p=r[12],M=r[13],g=r[14],m=r[15],S=e*c-s*h,w=e*a-i*h,x=e*f-t*h,o=s*a-i*c,A=s*f-t*c,N=i*f-t*a,I=l*M-v*p,P=l*g-d*p,E=l*m-_*p,Y=v*g-d*M,k=v*m-_*M,D=d*m-_*g,T=S*D-w*k+x*Y+o*E-A*P+N*I;return T?(T=1/T,n[0]=(c*D-a*k+f*Y)*T,n[1]=(i*k-s*D-t*Y)*T,n[2]=(M*N-g*A+m*o)*T,n[3]=(d*A-v*N-_*o)*T,n[4]=(a*E-h*D-f*P)*T,n[5]=(e*D-i*E+t*P)*T,n[6]=(g*x-p*N-m*w)*T,n[7]=(l*N-d*x+_*w)*T,n[8]=(h*k-c*E+f*I)*T,n[9]=(s*E-e*k-t*I)*T,n[10]=(p*A-M*x+m*S)*T,n[11]=(v*x-l*A-_*S)*T,n[12]=(c*P-h*Y-a*I)*T,n[13]=(e*Y-s*P+i*I)*T,n[14]=(M*w-p*o-g*S)*T,n[15]=(l*o-v*w+d*S)*T,n):null};$.adjoint=function(n,r){var e=r[0],s=r[1],i=r[2],t=r[3],h=r[4],c=r[5],a=r[6],f=r[7],l=r[8],v=r[9],d=r[10],_=r[11],p=r[12],M=r[13],g=r[14],m=r[15];return n[0]=c*(d*m-_*g)-v*(a*m-f*g)+M*(a*_-f*d),n[1]=-(s*(d*m-_*g)-v*(i*m-t*g)+M*(i*_-t*d)),n[2]=s*(a*m-f*g)-c*(i*m-t*g)+M*(i*f-t*a),n[3]=-(s*(a*_-f*d)-c*(i*_-t*d)+v*(i*f-t*a)),n[4]=-(h*(d*m-_*g)-l*(a*m-f*g)+p*(a*_-f*d)),n[5]=e*(d*m-_*g)-l*(i*m-t*g)+p*(i*_-t*d),n[6]=-(e*(a*m-f*g)-h*(i*m-t*g)+p*(i*f-t*a)),n[7]=e*(a*_-f*d)-h*(i*_-t*d)+l*(i*f-t*a),n[8]=h*(v*m-_*M)-l*(c*m-f*M)+p*(c*_-f*v),n[9]=-(e*(v*m-_*M)-l*(s*m-t*M)+p*(s*_-t*v)),n[10]=e*(c*m-f*M)-h*(s*m-t*M)+p*(s*f-t*c),n[11]=-(e*(c*_-f*v)-h*(s*_-t*v)+l*(s*f-t*c)),n[12]=-(h*(v*g-d*M)-l*(c*g-a*M)+p*(c*d-a*v)),n[13]=e*(v*g-d*M)-l*(s*g-i*M)+p*(s*d-i*v),n[14]=-(e*(c*g-a*M)-h*(s*g-i*M)+p*(s*a-i*c)),n[15]=e*(c*d-a*v)-h*(s*d-i*v)+l*(s*a-i*c),n};$.determinant=function(n){var r=n[0],e=n[1],s=n[2],i=n[3],t=n[4],h=n[5],c=n[6],a=n[7],f=n[8],l=n[9],v=n[10],d=n[11],_=n[12],p=n[13],M=n[14],g=n[15],m=r*h-e*t,S=r*c-s*t,w=r*a-i*t,x=e*c-s*h,o=e*a-i*h,A=s*a-i*c,N=f*p-l*_,I=f*M-v*_,P=f*g-d*_,E=l*M-v*p,Y=l*g-d*p,k=v*g-d*M;return m*k-S*Y+w*E+x*P-o*I+A*N};$.multiply=function(n,r,e){var s=r[0],i=r[1],t=r[2],h=r[3],c=r[4],a=r[5],f=r[6],l=r[7],v=r[8],d=r[9],_=r[10],p=r[11],M=r[12],g=r[13],m=r[14],S=r[15],w=e[0],x=e[1],o=e[2],A=e[3];return n[0]=w*s+x*c+o*v+A*M,n[1]=w*i+x*a+o*d+A*g,n[2]=w*t+x*f+o*_+A*m,n[3]=w*h+x*l+o*p+A*S,w=e[4],x=e[5],o=e[6],A=e[7],n[4]=w*s+x*c+o*v+A*M,n[5]=w*i+x*a+o*d+A*g,n[6]=w*t+x*f+o*_+A*m,n[7]=w*h+x*l+o*p+A*S,w=e[8],x=e[9],o=e[10],A=e[11],n[8]=w*s+x*c+o*v+A*M,n[9]=w*i+x*a+o*d+A*g,n[10]=w*t+x*f+o*_+A*m,n[11]=w*h+x*l+o*p+A*S,w=e[12],x=e[13],o=e[14],A=e[15],n[12]=w*s+x*c+o*v+A*M,n[13]=w*i+x*a+o*d+A*g,n[14]=w*t+x*f+o*_+A*m,n[15]=w*h+x*l+o*p+A*S,n};$.mul=$.multiply;$.translate=function(n,r,e){var s=e[0],i=e[1],t=e[2],h,c,a,f,l,v,d,_,p,M,g,m;return r===n?(n[12]=r[0]*s+r[4]*i+r[8]*t+r[12],n[13]=r[1]*s+r[5]*i+r[9]*t+r[13],n[14]=r[2]*s+r[6]*i+r[10]*t+r[14],n[15]=r[3]*s+r[7]*i+r[11]*t+r[15]):(h=r[0],c=r[1],a=r[2],f=r[3],l=r[4],v=r[5],d=r[6],_=r[7],p=r[8],M=r[9],g=r[10],m=r[11],n[0]=h,n[1]=c,n[2]=a,n[3]=f,n[4]=l,n[5]=v,n[6]=d,n[7]=_,n[8]=p,n[9]=M,n[10]=g,n[11]=m,n[12]=h*s+l*i+p*t+r[12],n[13]=c*s+v*i+M*t+r[13],n[14]=a*s+d*i+g*t+r[14],n[15]=f*s+_*i+m*t+r[15]),n};$.scale=function(n,r,e){var s=e[0],i=e[1],t=e[2];return n[0]=r[0]*s,n[1]=r[1]*s,n[2]=r[2]*s,n[3]=r[3]*s,n[4]=r[4]*i,n[5]=r[5]*i,n[6]=r[6]*i,n[7]=r[7]*i,n[8]=r[8]*t,n[9]=r[9]*t,n[10]=r[10]*t,n[11]=r[11]*t,n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],n};$.rotate=function(n,r,e,s){var i=s[0],t=s[1],h=s[2],c=Math.sqrt(i*i+t*t+h*h),a,f,l,v,d,_,p,M,g,m,S,w,x,o,A,N,I,P,E,Y,k,D,T,u;return Math.abs(c)<Q.EPSILON?null:(c=1/c,i*=c,t*=c,h*=c,a=Math.sin(e),f=Math.cos(e),l=1-f,v=r[0],d=r[1],_=r[2],p=r[3],M=r[4],g=r[5],m=r[6],S=r[7],w=r[8],x=r[9],o=r[10],A=r[11],N=i*i*l+f,I=t*i*l+h*a,P=h*i*l-t*a,E=i*t*l-h*a,Y=t*t*l+f,k=h*t*l+i*a,D=i*h*l+t*a,T=t*h*l-i*a,u=h*h*l+f,n[0]=v*N+M*I+w*P,n[1]=d*N+g*I+x*P,n[2]=_*N+m*I+o*P,n[3]=p*N+S*I+A*P,n[4]=v*E+M*Y+w*k,n[5]=d*E+g*Y+x*k,n[6]=_*E+m*Y+o*k,n[7]=p*E+S*Y+A*k,n[8]=v*D+M*T+w*u,n[9]=d*D+g*T+x*u,n[10]=_*D+m*T+o*u,n[11]=p*D+S*T+A*u,r!==n&&(n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15]),n)};$.rotateX=function(n,r,e){var s=Math.sin(e),i=Math.cos(e),t=r[4],h=r[5],c=r[6],a=r[7],f=r[8],l=r[9],v=r[10],d=r[11];return r!==n&&(n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15]),n[4]=t*i+f*s,n[5]=h*i+l*s,n[6]=c*i+v*s,n[7]=a*i+d*s,n[8]=f*i-t*s,n[9]=l*i-h*s,n[10]=v*i-c*s,n[11]=d*i-a*s,n};$.rotateY=function(n,r,e){var s=Math.sin(e),i=Math.cos(e),t=r[0],h=r[1],c=r[2],a=r[3],f=r[8],l=r[9],v=r[10],d=r[11];return r!==n&&(n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15]),n[0]=t*i-f*s,n[1]=h*i-l*s,n[2]=c*i-v*s,n[3]=a*i-d*s,n[8]=t*s+f*i,n[9]=h*s+l*i,n[10]=c*s+v*i,n[11]=a*s+d*i,n};$.rotateZ=function(n,r,e){var s=Math.sin(e),i=Math.cos(e),t=r[0],h=r[1],c=r[2],a=r[3],f=r[4],l=r[5],v=r[6],d=r[7];return r!==n&&(n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15]),n[0]=t*i+f*s,n[1]=h*i+l*s,n[2]=c*i+v*s,n[3]=a*i+d*s,n[4]=f*i-t*s,n[5]=l*i-h*s,n[6]=v*i-c*s,n[7]=d*i-a*s,n};$.fromTranslation=function(n,r){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=r[0],n[13]=r[1],n[14]=r[2],n[15]=1,n};$.fromScaling=function(n,r){return n[0]=r[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=r[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n};$.fromRotation=function(n,r,e){var s=e[0],i=e[1],t=e[2],h=Math.sqrt(s*s+i*i+t*t),c,a,f;return Math.abs(h)<Q.EPSILON?null:(h=1/h,s*=h,i*=h,t*=h,c=Math.sin(r),a=Math.cos(r),f=1-a,n[0]=s*s*f+a,n[1]=i*s*f+t*c,n[2]=t*s*f-i*c,n[3]=0,n[4]=s*i*f-t*c,n[5]=i*i*f+a,n[6]=t*i*f+s*c,n[7]=0,n[8]=s*t*f+i*c,n[9]=i*t*f-s*c,n[10]=t*t*f+a,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)};$.fromXRotation=function(n,r){var e=Math.sin(r),s=Math.cos(r);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s,n[6]=e,n[7]=0,n[8]=0,n[9]=-e,n[10]=s,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n};$.fromYRotation=function(n,r){var e=Math.sin(r),s=Math.cos(r);return n[0]=s,n[1]=0,n[2]=-e,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=e,n[9]=0,n[10]=s,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n};$.fromZRotation=function(n,r){var e=Math.sin(r),s=Math.cos(r);return n[0]=s,n[1]=e,n[2]=0,n[3]=0,n[4]=-e,n[5]=s,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n};$.fromRotationTranslation=function(n,r,e){var s=r[0],i=r[1],t=r[2],h=r[3],c=s+s,a=i+i,f=t+t,l=s*c,v=s*a,d=s*f,_=i*a,p=i*f,M=t*f,g=h*c,m=h*a,S=h*f;return n[0]=1-(_+M),n[1]=v+S,n[2]=d-m,n[3]=0,n[4]=v-S,n[5]=1-(l+M),n[6]=p+g,n[7]=0,n[8]=d+m,n[9]=p-g,n[10]=1-(l+_),n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n};$.fromRotationTranslationScale=function(n,r,e,s){var i=r[0],t=r[1],h=r[2],c=r[3],a=i+i,f=t+t,l=h+h,v=i*a,d=i*f,_=i*l,p=t*f,M=t*l,g=h*l,m=c*a,S=c*f,w=c*l,x=s[0],o=s[1],A=s[2];return n[0]=(1-(p+g))*x,n[1]=(d+w)*x,n[2]=(_-S)*x,n[3]=0,n[4]=(d-w)*o,n[5]=(1-(v+g))*o,n[6]=(M+m)*o,n[7]=0,n[8]=(_+S)*A,n[9]=(M-m)*A,n[10]=(1-(v+p))*A,n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n};$.fromRotationTranslationScaleOrigin=function(n,r,e,s,i){var t=r[0],h=r[1],c=r[2],a=r[3],f=t+t,l=h+h,v=c+c,d=t*f,_=t*l,p=t*v,M=h*l,g=h*v,m=c*v,S=a*f,w=a*l,x=a*v,o=s[0],A=s[1],N=s[2],I=i[0],P=i[1],E=i[2];return n[0]=(1-(M+m))*o,n[1]=(_+x)*o,n[2]=(p-w)*o,n[3]=0,n[4]=(_-x)*A,n[5]=(1-(d+m))*A,n[6]=(g+S)*A,n[7]=0,n[8]=(p+w)*N,n[9]=(g-S)*N,n[10]=(1-(d+M))*N,n[11]=0,n[12]=e[0]+I-(n[0]*I+n[4]*P+n[8]*E),n[13]=e[1]+P-(n[1]*I+n[5]*P+n[9]*E),n[14]=e[2]+E-(n[2]*I+n[6]*P+n[10]*E),n[15]=1,n};$.fromQuat=function(n,r){var e=r[0],s=r[1],i=r[2],t=r[3],h=e+e,c=s+s,a=i+i,f=e*h,l=s*h,v=s*c,d=i*h,_=i*c,p=i*a,M=t*h,g=t*c,m=t*a;return n[0]=1-v-p,n[1]=l+m,n[2]=d-g,n[3]=0,n[4]=l-m,n[5]=1-f-p,n[6]=_+M,n[7]=0,n[8]=d+g,n[9]=_-M,n[10]=1-f-v,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n};$.frustum=function(n,r,e,s,i,t,h){var c=1/(e-r),a=1/(i-s),f=1/(t-h);return n[0]=t*2*c,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t*2*a,n[6]=0,n[7]=0,n[8]=(e+r)*c,n[9]=(i+s)*a,n[10]=(h+t)*f,n[11]=-1,n[12]=0,n[13]=0,n[14]=h*t*2*f,n[15]=0,n};$.perspective=function(n,r,e,s,i){var t=1/Math.tan(r/2),h=1/(s-i);return n[0]=t/e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(i+s)*h,n[11]=-1,n[12]=0,n[13]=0,n[14]=2*i*s*h,n[15]=0,n};$.perspectiveFromFieldOfView=function(n,r,e,s){var i=Math.tan(r.upDegrees*Math.PI/180),t=Math.tan(r.downDegrees*Math.PI/180),h=Math.tan(r.leftDegrees*Math.PI/180),c=Math.tan(r.rightDegrees*Math.PI/180),a=2/(h+c),f=2/(i+t);return n[0]=a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=f,n[6]=0,n[7]=0,n[8]=-((h-c)*a*.5),n[9]=(i-t)*f*.5,n[10]=s/(e-s),n[11]=-1,n[12]=0,n[13]=0,n[14]=s*e/(e-s),n[15]=0,n};$.ortho=function(n,r,e,s,i,t,h){var c=1/(r-e),a=1/(s-i),f=1/(t-h);return n[0]=-2*c,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*a,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*f,n[11]=0,n[12]=(r+e)*c,n[13]=(i+s)*a,n[14]=(h+t)*f,n[15]=1,n};$.lookAt=function(n,r,e,s){var i,t,h,c,a,f,l,v,d,_,p=r[0],M=r[1],g=r[2],m=s[0],S=s[1],w=s[2],x=e[0],o=e[1],A=e[2];return Math.abs(p-x)<Q.EPSILON&&Math.abs(M-o)<Q.EPSILON&&Math.abs(g-A)<Q.EPSILON?$.identity(n):(l=p-x,v=M-o,d=g-A,_=1/Math.sqrt(l*l+v*v+d*d),l*=_,v*=_,d*=_,i=S*d-w*v,t=w*l-m*d,h=m*v-S*l,_=Math.sqrt(i*i+t*t+h*h),_?(_=1/_,i*=_,t*=_,h*=_):(i=0,t=0,h=0),c=v*h-d*t,a=d*i-l*h,f=l*t-v*i,_=Math.sqrt(c*c+a*a+f*f),_?(_=1/_,c*=_,a*=_,f*=_):(c=0,a=0,f=0),n[0]=i,n[1]=c,n[2]=l,n[3]=0,n[4]=t,n[5]=a,n[6]=v,n[7]=0,n[8]=h,n[9]=f,n[10]=d,n[11]=0,n[12]=-(i*p+t*M+h*g),n[13]=-(c*p+a*M+f*g),n[14]=-(l*p+v*M+d*g),n[15]=1,n)};$.str=function(n){return"mat4("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+", "+n[8]+", "+n[9]+", "+n[10]+", "+n[11]+", "+n[12]+", "+n[13]+", "+n[14]+", "+n[15]+")"};$.frob=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)+Math.pow(n[3],2)+Math.pow(n[4],2)+Math.pow(n[5],2)+Math.pow(n[6],2)+Math.pow(n[7],2)+Math.pow(n[8],2)+Math.pow(n[9],2)+Math.pow(n[10],2)+Math.pow(n[11],2)+Math.pow(n[12],2)+Math.pow(n[13],2)+Math.pow(n[14],2)+Math.pow(n[15],2))};var Bn=$,sn=X,y={};y.create=function(){var n=new sn.ARRAY_TYPE(3);return n[0]=0,n[1]=0,n[2]=0,n};y.clone=function(n){var r=new sn.ARRAY_TYPE(3);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r};y.fromValues=function(n,r,e){var s=new sn.ARRAY_TYPE(3);return s[0]=n,s[1]=r,s[2]=e,s};y.copy=function(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n};y.set=function(n,r,e,s){return n[0]=r,n[1]=e,n[2]=s,n};y.add=function(n,r,e){return n[0]=r[0]+e[0],n[1]=r[1]+e[1],n[2]=r[2]+e[2],n};y.subtract=function(n,r,e){return n[0]=r[0]-e[0],n[1]=r[1]-e[1],n[2]=r[2]-e[2],n};y.sub=y.subtract;y.multiply=function(n,r,e){return n[0]=r[0]*e[0],n[1]=r[1]*e[1],n[2]=r[2]*e[2],n};y.mul=y.multiply;y.divide=function(n,r,e){return n[0]=r[0]/e[0],n[1]=r[1]/e[1],n[2]=r[2]/e[2],n};y.div=y.divide;y.min=function(n,r,e){return n[0]=Math.min(r[0],e[0]),n[1]=Math.min(r[1],e[1]),n[2]=Math.min(r[2],e[2]),n};y.max=function(n,r,e){return n[0]=Math.max(r[0],e[0]),n[1]=Math.max(r[1],e[1]),n[2]=Math.max(r[2],e[2]),n};y.scale=function(n,r,e){return n[0]=r[0]*e,n[1]=r[1]*e,n[2]=r[2]*e,n};y.scaleAndAdd=function(n,r,e,s){return n[0]=r[0]+e[0]*s,n[1]=r[1]+e[1]*s,n[2]=r[2]+e[2]*s,n};y.distance=function(n,r){var e=r[0]-n[0],s=r[1]-n[1],i=r[2]-n[2];return Math.sqrt(e*e+s*s+i*i)};y.dist=y.distance;y.squaredDistance=function(n,r){var e=r[0]-n[0],s=r[1]-n[1],i=r[2]-n[2];return e*e+s*s+i*i};y.sqrDist=y.squaredDistance;y.length=function(n){var r=n[0],e=n[1],s=n[2];return Math.sqrt(r*r+e*e+s*s)};y.len=y.length;y.squaredLength=function(n){var r=n[0],e=n[1],s=n[2];return r*r+e*e+s*s};y.sqrLen=y.squaredLength;y.negate=function(n,r){return n[0]=-r[0],n[1]=-r[1],n[2]=-r[2],n};y.inverse=function(n,r){return n[0]=1/r[0],n[1]=1/r[1],n[2]=1/r[2],n};y.normalize=function(n,r){var e=r[0],s=r[1],i=r[2],t=e*e+s*s+i*i;return t>0&&(t=1/Math.sqrt(t),n[0]=r[0]*t,n[1]=r[1]*t,n[2]=r[2]*t),n};y.dot=function(n,r){return n[0]*r[0]+n[1]*r[1]+n[2]*r[2]};y.cross=function(n,r,e){var s=r[0],i=r[1],t=r[2],h=e[0],c=e[1],a=e[2];return n[0]=i*a-t*c,n[1]=t*h-s*a,n[2]=s*c-i*h,n};y.lerp=function(n,r,e,s){var i=r[0],t=r[1],h=r[2];return n[0]=i+s*(e[0]-i),n[1]=t+s*(e[1]-t),n[2]=h+s*(e[2]-h),n};y.hermite=function(n,r,e,s,i,t){var h=t*t,c=h*(2*t-3)+1,a=h*(t-2)+t,f=h*(t-1),l=h*(3-2*t);return n[0]=r[0]*c+e[0]*a+s[0]*f+i[0]*l,n[1]=r[1]*c+e[1]*a+s[1]*f+i[1]*l,n[2]=r[2]*c+e[2]*a+s[2]*f+i[2]*l,n};y.bezier=function(n,r,e,s,i,t){var h=1-t,c=h*h,a=t*t,f=c*h,l=3*t*c,v=3*a*h,d=a*t;return n[0]=r[0]*f+e[0]*l+s[0]*v+i[0]*d,n[1]=r[1]*f+e[1]*l+s[1]*v+i[1]*d,n[2]=r[2]*f+e[2]*l+s[2]*v+i[2]*d,n};y.random=function(n,r){r=r||1;var e=sn.RANDOM()*2*Math.PI,s=sn.RANDOM()*2-1,i=Math.sqrt(1-s*s)*r;return n[0]=Math.cos(e)*i,n[1]=Math.sin(e)*i,n[2]=s*r,n};y.transformMat4=function(n,r,e){var s=r[0],i=r[1],t=r[2],h=e[3]*s+e[7]*i+e[11]*t+e[15];return h=h||1,n[0]=(e[0]*s+e[4]*i+e[8]*t+e[12])/h,n[1]=(e[1]*s+e[5]*i+e[9]*t+e[13])/h,n[2]=(e[2]*s+e[6]*i+e[10]*t+e[14])/h,n};y.transformMat3=function(n,r,e){var s=r[0],i=r[1],t=r[2];return n[0]=s*e[0]+i*e[3]+t*e[6],n[1]=s*e[1]+i*e[4]+t*e[7],n[2]=s*e[2]+i*e[5]+t*e[8],n};y.transformQuat=function(n,r,e){var s=r[0],i=r[1],t=r[2],h=e[0],c=e[1],a=e[2],f=e[3],l=f*s+c*t-a*i,v=f*i+a*s-h*t,d=f*t+h*i-c*s,_=-h*s-c*i-a*t;return n[0]=l*f+_*-h+v*-a-d*-c,n[1]=v*f+_*-c+d*-h-l*-a,n[2]=d*f+_*-a+l*-c-v*-h,n};y.rotateX=function(n,r,e,s){var i=[],t=[];return i[0]=r[0]-e[0],i[1]=r[1]-e[1],i[2]=r[2]-e[2],t[0]=i[0],t[1]=i[1]*Math.cos(s)-i[2]*Math.sin(s),t[2]=i[1]*Math.sin(s)+i[2]*Math.cos(s),n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n};y.rotateY=function(n,r,e,s){var i=[],t=[];return i[0]=r[0]-e[0],i[1]=r[1]-e[1],i[2]=r[2]-e[2],t[0]=i[2]*Math.sin(s)+i[0]*Math.cos(s),t[1]=i[1],t[2]=i[2]*Math.cos(s)-i[0]*Math.sin(s),n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n};y.rotateZ=function(n,r,e,s){var i=[],t=[];return i[0]=r[0]-e[0],i[1]=r[1]-e[1],i[2]=r[2]-e[2],t[0]=i[0]*Math.cos(s)-i[1]*Math.sin(s),t[1]=i[0]*Math.sin(s)+i[1]*Math.cos(s),t[2]=i[2],n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n};y.forEach=function(){var n=y.create();return function(r,e,s,i,t,h){var c,a;for(e||(e=3),s||(s=0),i?a=Math.min(i*e+s,r.length):a=r.length,c=s;c<a;c+=e)n[0]=r[c],n[1]=r[c+1],n[2]=r[c+2],t(n,n,h),r[c]=n[0],r[c+1]=n[1],r[c+2]=n[2];return r}}();y.angle=function(n,r){var e=y.fromValues(n[0],n[1],n[2]),s=y.fromValues(r[0],r[1],r[2]);y.normalize(e,e),y.normalize(s,s);var i=y.dot(e,s);return i>1?0:Math.acos(i)};y.str=function(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"};var Nn=y,H=X,C={};C.create=function(){var n=new H.ARRAY_TYPE(4);return n[0]=0,n[1]=0,n[2]=0,n[3]=0,n};C.clone=function(n){var r=new H.ARRAY_TYPE(4);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r};C.fromValues=function(n,r,e,s){var i=new H.ARRAY_TYPE(4);return i[0]=n,i[1]=r,i[2]=e,i[3]=s,i};C.copy=function(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n};C.set=function(n,r,e,s,i){return n[0]=r,n[1]=e,n[2]=s,n[3]=i,n};C.add=function(n,r,e){return n[0]=r[0]+e[0],n[1]=r[1]+e[1],n[2]=r[2]+e[2],n[3]=r[3]+e[3],n};C.subtract=function(n,r,e){return n[0]=r[0]-e[0],n[1]=r[1]-e[1],n[2]=r[2]-e[2],n[3]=r[3]-e[3],n};C.sub=C.subtract;C.multiply=function(n,r,e){return n[0]=r[0]*e[0],n[1]=r[1]*e[1],n[2]=r[2]*e[2],n[3]=r[3]*e[3],n};C.mul=C.multiply;C.divide=function(n,r,e){return n[0]=r[0]/e[0],n[1]=r[1]/e[1],n[2]=r[2]/e[2],n[3]=r[3]/e[3],n};C.div=C.divide;C.min=function(n,r,e){return n[0]=Math.min(r[0],e[0]),n[1]=Math.min(r[1],e[1]),n[2]=Math.min(r[2],e[2]),n[3]=Math.min(r[3],e[3]),n};C.max=function(n,r,e){return n[0]=Math.max(r[0],e[0]),n[1]=Math.max(r[1],e[1]),n[2]=Math.max(r[2],e[2]),n[3]=Math.max(r[3],e[3]),n};C.scale=function(n,r,e){return n[0]=r[0]*e,n[1]=r[1]*e,n[2]=r[2]*e,n[3]=r[3]*e,n};C.scaleAndAdd=function(n,r,e,s){return n[0]=r[0]+e[0]*s,n[1]=r[1]+e[1]*s,n[2]=r[2]+e[2]*s,n[3]=r[3]+e[3]*s,n};C.distance=function(n,r){var e=r[0]-n[0],s=r[1]-n[1],i=r[2]-n[2],t=r[3]-n[3];return Math.sqrt(e*e+s*s+i*i+t*t)};C.dist=C.distance;C.squaredDistance=function(n,r){var e=r[0]-n[0],s=r[1]-n[1],i=r[2]-n[2],t=r[3]-n[3];return e*e+s*s+i*i+t*t};C.sqrDist=C.squaredDistance;C.length=function(n){var r=n[0],e=n[1],s=n[2],i=n[3];return Math.sqrt(r*r+e*e+s*s+i*i)};C.len=C.length;C.squaredLength=function(n){var r=n[0],e=n[1],s=n[2],i=n[3];return r*r+e*e+s*s+i*i};C.sqrLen=C.squaredLength;C.negate=function(n,r){return n[0]=-r[0],n[1]=-r[1],n[2]=-r[2],n[3]=-r[3],n};C.inverse=function(n,r){return n[0]=1/r[0],n[1]=1/r[1],n[2]=1/r[2],n[3]=1/r[3],n};C.normalize=function(n,r){var e=r[0],s=r[1],i=r[2],t=r[3],h=e*e+s*s+i*i+t*t;return h>0&&(h=1/Math.sqrt(h),n[0]=e*h,n[1]=s*h,n[2]=i*h,n[3]=t*h),n};C.dot=function(n,r){return n[0]*r[0]+n[1]*r[1]+n[2]*r[2]+n[3]*r[3]};C.lerp=function(n,r,e,s){var i=r[0],t=r[1],h=r[2],c=r[3];return n[0]=i+s*(e[0]-i),n[1]=t+s*(e[1]-t),n[2]=h+s*(e[2]-h),n[3]=c+s*(e[3]-c),n};C.random=function(n,r){return r=r||1,n[0]=H.RANDOM(),n[1]=H.RANDOM(),n[2]=H.RANDOM(),n[3]=H.RANDOM(),C.normalize(n,n),C.scale(n,n,r),n};C.transformMat4=function(n,r,e){var s=r[0],i=r[1],t=r[2],h=r[3];return n[0]=e[0]*s+e[4]*i+e[8]*t+e[12]*h,n[1]=e[1]*s+e[5]*i+e[9]*t+e[13]*h,n[2]=e[2]*s+e[6]*i+e[10]*t+e[14]*h,n[3]=e[3]*s+e[7]*i+e[11]*t+e[15]*h,n};C.transformQuat=function(n,r,e){var s=r[0],i=r[1],t=r[2],h=e[0],c=e[1],a=e[2],f=e[3],l=f*s+c*t-a*i,v=f*i+a*s-h*t,d=f*t+h*i-c*s,_=-h*s-c*i-a*t;return n[0]=l*f+_*-h+v*-a-d*-c,n[1]=v*f+_*-c+d*-h-l*-a,n[2]=d*f+_*-a+l*-c-v*-h,n[3]=r[3],n};C.forEach=function(){var n=C.create();return function(r,e,s,i,t,h){var c,a;for(e||(e=4),s||(s=0),i?a=Math.min(i*e+s,r.length):a=r.length,c=s;c<a;c+=e)n[0]=r[c],n[1]=r[c+1],n[2]=r[c+2],n[3]=r[c+3],t(n,n,h),r[c]=n[0],r[c+1]=n[1],r[c+2]=n[2],r[c+3]=n[3];return r}}();C.str=function(n){return"vec4("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"};var Xn=C,Hn=X,Qn=Pn,G=Nn,U=Xn,z={};z.create=function(){var n=new Hn.ARRAY_TYPE(4);return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n};z.rotationTo=function(){var n=G.create(),r=G.fromValues(1,0,0),e=G.fromValues(0,1,0);return function(s,i,t){var h=G.dot(i,t);return h<-.999999?(G.cross(n,r,i),G.length(n)<1e-6&&G.cross(n,e,i),G.normalize(n,n),z.setAxisAngle(s,n,Math.PI),s):h>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(G.cross(n,i,t),s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=1+h,z.normalize(s,s))}}();z.setAxes=function(){var n=Qn.create();return function(r,e,s,i){return n[0]=s[0],n[3]=s[1],n[6]=s[2],n[1]=i[0],n[4]=i[1],n[7]=i[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],z.normalize(r,z.fromMat3(r,n))}}();z.clone=U.clone;z.fromValues=U.fromValues;z.copy=U.copy;z.set=U.set;z.identity=function(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n};z.setAxisAngle=function(n,r,e){e=e*.5;var s=Math.sin(e);return n[0]=s*r[0],n[1]=s*r[1],n[2]=s*r[2],n[3]=Math.cos(e),n};z.add=U.add;z.multiply=function(n,r,e){var s=r[0],i=r[1],t=r[2],h=r[3],c=e[0],a=e[1],f=e[2],l=e[3];return n[0]=s*l+h*c+i*f-t*a,n[1]=i*l+h*a+t*c-s*f,n[2]=t*l+h*f+s*a-i*c,n[3]=h*l-s*c-i*a-t*f,n};z.mul=z.multiply;z.scale=U.scale;z.rotateX=function(n,r,e){e*=.5;var s=r[0],i=r[1],t=r[2],h=r[3],c=Math.sin(e),a=Math.cos(e);return n[0]=s*a+h*c,n[1]=i*a+t*c,n[2]=t*a-i*c,n[3]=h*a-s*c,n};z.rotateY=function(n,r,e){e*=.5;var s=r[0],i=r[1],t=r[2],h=r[3],c=Math.sin(e),a=Math.cos(e);return n[0]=s*a-t*c,n[1]=i*a+h*c,n[2]=t*a+s*c,n[3]=h*a-i*c,n};z.rotateZ=function(n,r,e){e*=.5;var s=r[0],i=r[1],t=r[2],h=r[3],c=Math.sin(e),a=Math.cos(e);return n[0]=s*a+i*c,n[1]=i*a-s*c,n[2]=t*a+h*c,n[3]=h*a-t*c,n};z.calculateW=function(n,r){var e=r[0],s=r[1],i=r[2];return n[0]=e,n[1]=s,n[2]=i,n[3]=Math.sqrt(Math.abs(1-e*e-s*s-i*i)),n};z.dot=U.dot;z.lerp=U.lerp;z.slerp=function(n,r,e,s){var i=r[0],t=r[1],h=r[2],c=r[3],a=e[0],f=e[1],l=e[2],v=e[3],d,_,p,M,g;return _=i*a+t*f+h*l+c*v,_<0&&(_=-_,a=-a,f=-f,l=-l,v=-v),1-_>1e-6?(d=Math.acos(_),p=Math.sin(d),M=Math.sin((1-s)*d)/p,g=Math.sin(s*d)/p):(M=1-s,g=s),n[0]=M*i+g*a,n[1]=M*t+g*f,n[2]=M*h+g*l,n[3]=M*c+g*v,n};z.sqlerp=function(){var n=z.create(),r=z.create();return function(e,s,i,t,h,c){return z.slerp(n,s,h,c),z.slerp(r,i,t,c),z.slerp(e,n,r,2*c*(1-c)),e}}();z.invert=function(n,r){var e=r[0],s=r[1],i=r[2],t=r[3],h=e*e+s*s+i*i+t*t,c=h?1/h:0;return n[0]=-e*c,n[1]=-s*c,n[2]=-i*c,n[3]=t*c,n};z.conjugate=function(n,r){return n[0]=-r[0],n[1]=-r[1],n[2]=-r[2],n[3]=r[3],n};z.length=U.length;z.len=z.length;z.squaredLength=U.squaredLength;z.sqrLen=z.squaredLength;z.normalize=U.normalize;z.fromMat3=function(n,r){var e=r[0]+r[4]+r[8],s;if(e>0)s=Math.sqrt(e+1),n[3]=.5*s,s=.5/s,n[0]=(r[5]-r[7])*s,n[1]=(r[6]-r[2])*s,n[2]=(r[1]-r[3])*s;else{var i=0;r[4]>r[0]&&(i=1),r[8]>r[i*3+i]&&(i=2);var t=(i+1)%3,h=(i+2)%3;s=Math.sqrt(r[i*3+i]-r[t*3+t]-r[h*3+h]+1),n[i]=.5*s,s=.5/s,n[3]=(r[t*3+h]-r[h*3+t])*s,n[t]=(r[t*3+i]+r[i*3+t])*s,n[h]=(r[h*3+i]+r[i*3+h])*s}return n};z.str=function(n){return"quat("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"};var an=X,R={};R.create=function(){var n=new an.ARRAY_TYPE(2);return n[0]=0,n[1]=0,n};R.clone=function(n){var r=new an.ARRAY_TYPE(2);return r[0]=n[0],r[1]=n[1],r};R.fromValues=function(n,r){var e=new an.ARRAY_TYPE(2);return e[0]=n,e[1]=r,e};R.copy=function(n,r){return n[0]=r[0],n[1]=r[1],n};R.set=function(n,r,e){return n[0]=r,n[1]=e,n};R.add=function(n,r,e){return n[0]=r[0]+e[0],n[1]=r[1]+e[1],n};R.subtract=function(n,r,e){return n[0]=r[0]-e[0],n[1]=r[1]-e[1],n};R.sub=R.subtract;R.multiply=function(n,r,e){return n[0]=r[0]*e[0],n[1]=r[1]*e[1],n};R.mul=R.multiply;R.divide=function(n,r,e){return n[0]=r[0]/e[0],n[1]=r[1]/e[1],n};R.div=R.divide;R.min=function(n,r,e){return n[0]=Math.min(r[0],e[0]),n[1]=Math.min(r[1],e[1]),n};R.max=function(n,r,e){return n[0]=Math.max(r[0],e[0]),n[1]=Math.max(r[1],e[1]),n};R.scale=function(n,r,e){return n[0]=r[0]*e,n[1]=r[1]*e,n};R.scaleAndAdd=function(n,r,e,s){return n[0]=r[0]+e[0]*s,n[1]=r[1]+e[1]*s,n};R.distance=function(n,r){var e=r[0]-n[0],s=r[1]-n[1];return Math.sqrt(e*e+s*s)};R.dist=R.distance;R.squaredDistance=function(n,r){var e=r[0]-n[0],s=r[1]-n[1];return e*e+s*s};R.sqrDist=R.squaredDistance;R.length=function(n){var r=n[0],e=n[1];return Math.sqrt(r*r+e*e)};R.len=R.length;R.squaredLength=function(n){var r=n[0],e=n[1];return r*r+e*e};R.sqrLen=R.squaredLength;R.negate=function(n,r){return n[0]=-r[0],n[1]=-r[1],n};R.inverse=function(n,r){return n[0]=1/r[0],n[1]=1/r[1],n};R.normalize=function(n,r){var e=r[0],s=r[1],i=e*e+s*s;return i>0&&(i=1/Math.sqrt(i),n[0]=r[0]*i,n[1]=r[1]*i),n};R.dot=function(n,r){return n[0]*r[0]+n[1]*r[1]};R.cross=function(n,r,e){var s=r[0]*e[1]-r[1]*e[0];return n[0]=n[1]=0,n[2]=s,n};R.lerp=function(n,r,e,s){var i=r[0],t=r[1];return n[0]=i+s*(e[0]-i),n[1]=t+s*(e[1]-t),n};R.random=function(n,r){r=r||1;var e=an.RANDOM()*2*Math.PI;return n[0]=Math.cos(e)*r,n[1]=Math.sin(e)*r,n};R.transformMat2=function(n,r,e){var s=r[0],i=r[1];return n[0]=e[0]*s+e[2]*i,n[1]=e[1]*s+e[3]*i,n};R.transformMat2d=function(n,r,e){var s=r[0],i=r[1];return n[0]=e[0]*s+e[2]*i+e[4],n[1]=e[1]*s+e[3]*i+e[5],n};R.transformMat3=function(n,r,e){var s=r[0],i=r[1];return n[0]=e[0]*s+e[3]*i+e[6],n[1]=e[1]*s+e[4]*i+e[7],n};R.transformMat4=function(n,r,e){var s=r[0],i=r[1];return n[0]=e[0]*s+e[4]*i+e[12],n[1]=e[1]*s+e[5]*i+e[13],n};R.forEach=function(){var n=R.create();return function(r,e,s,i,t,h){var c,a;for(e||(e=2),s||(s=0),i?a=Math.min(i*e+s,r.length):a=r.length,c=s;c<a;c+=e)n[0]=r[c],n[1]=r[c+1],t(n,n,h),r[c]=n[0],r[c+1]=n[1];return r}}();R.str=function(n){return"vec2("+n[0]+", "+n[1]+")"};var kn=Pn,gr=Bn,Mr=Nn,j=function(n){var r="";return r+=`#if __VERSION__ == 300
  #define IN in
  #define OUT out
#else
  #define IN attribute
  #define OUT varying
#endif`,r};j.toString=j;var mr=j;j._hmrListeners=[];j.onHmr=function(n){this._hmrListeners.push(n)};j._triggerHmr=function(){for(const n of this._hmrListeners)n(this)};var K=function(n){var r="";return r+=`#if __VERSION__ == 300
  #define IN in
  #define texture2D(a,b) texture( a, b )
#else
  #define IN varying
  #define FragColor gl_FragColor
#endif

#if __VERSION__ == 300
  out vec4 FragColor;
#endif`,r};K.toString=K;var yr=K;K._hmrListeners=[];K.onHmr=function(n){this._hmrListeners.push(n)};K._triggerHmr=function(){for(const n of this._hmrListeners)n(this)};class xr extends B{constructor(r="mediump"){super(!0,!1),this.fprecision=r}set(r){this.fprecision=r}_genCode(r){const e=`precision ${this.fprecision} float;
`;r.add("precision",e)}}function Zn(n){return n=n^1204521612^n<<12,n=n^1638500540^n>>19,n=n^2027070408^n<<5,n=n^1500688830^n<<9,n=n^782708222^n<<3,n=n^1609631101^n>>16,n}function tn(n,r){r=Zn(r);let e=r>>0&15,s=r>>4&15,i=r>>8&15,t=r>>12&15;return n=r^(n^1204521612)<<e^(r^(n^2027070408)>>31-e),n=r^(n^1638500540)<<s^(r^(n^1500688830)>>31-s),n=r^(n^2027070408)<<i^(r^(n^782708222)>>31-i),n=r^(n^1500688830)<<t^(r^(n^1609631101)>>31-t),n}let gn;const rn=new ArrayBuffer(1024*16),An=new Uint8Array(rn),Wn=new Uint16Array(rn);if(TextEncoder!==void 0){const n=new TextEncoder;gn=r=>{const e=n.encode(r);if(e.byteLength>rn.byteLength)throw new Error("string is too big");let s=e.byteLength;return s&1&&(s=s+1,An[e.byteLength]=0),An.set(e),new Uint16Array(rn,0,s/2)}}else gn=n=>{const r=n.length;for(let e=0;e<r;e++)Wn[e]=n.charCodeAt(e);return new Uint16Array(rn,0,r)};function fn(n,r=0){const e=gn(n);for(let s=0;s<e.length;s++)r=tn(r,0|e[s]);return r}const On=new ArrayBuffer(8),jn=new Float64Array(On),on=new Uint32Array(On);function Kn(n,r=0){return jn[0]=n,r=tn(r,0|on[0]),r=tn(r,0|on[1]),r}function mn(n,r){return Kn(n,r)}function Jn(n,r=0){let e=n.byteLength,s=(n.byteLength&1)!==0;s&&(e=n.byteLength-1);const i=new Uint16Array(n.buffer,n.byteOffset,e/2);for(let t=0;t<i.length;t++)r=tn(r,0|i[t]);if(s){const t=new Uint8Array(n.buffer,n.byteOffset+n.byteLength-1,1)[0];r=tn(r,0|t<<8)}return r}function Mn(n){let r=n.toString(16);return r[0]==="-"&&(r=r.replace("-","z")),r}class un{constructor(r){this.code=r,this.hash=fn(r)}}class nr{constructor(r){this._hash=0,this.hashset=new Set,this.codes=[],this._code="",this.key=r}add(r){this.hashset.has(r.hash)||(this.hashset.add(r.hash),this.codes.push(r),this._code+=r.code+`
`,this._hash=mn(this._hash,r.hash))}merge(r){for(const e of r.codes)this.add(e)}get code(){return this._code}get hash(){return this._hash}}class Yn{constructor(){this.hash=0,this.slots=[],this.slotsMap={}}getHash(){let r=0;for(const e of this.slots)r=mn(r,e.hash);return r}getSlot(r){var e=this.slotsMap[r];return e===void 0&&(e=new nr(r),this.slotsMap[r]=e,this.slots.push(e)),e}add(r,e){this.getSlot(r).add(new un(e))}merge(r){for(var e of r.slots)this.getSlot(e.key).merge(e)}}class Dn{constructor(){this._invalidList=!0,this._invalidCode=!0,this._revision=0,this._all=new Set,this._actives=new Set,this._chunks=[],this._setups=[],this._codes=[],this._cachedSlots=null}add(r){return this._chunks.indexOf(r)===-1&&(this._chunks.push(r),this.invalidateList()),r}remove(r){const e=this._chunks.indexOf(r);e>-1&&(this._chunks.splice(e,1),this.invalidateList())}addChunks(r){for(const e of r)this.add(e)}invalidateList(){this._invalidList=!0,this.invalidateCode()}invalidateCode(){this._invalidCode||(this._invalidCode=!0,this._revision++)}isInvalid(){return this._invalidList||this._invalidCode}getRevision(){return this._revision}_collectChunks(){const r=this._all,e=this._setups,s=this._codes,i=this._actives;for(const t of r)t.removeList(this);r.clear(),i.clear(),e.length=0,s.length=0;for(const t of this._chunks)t.collectChunks(r,i);for(const t of i)t.hasSetup&&e.push(t),t.hasCode&&s.push(t);for(const t of r)t.addList(this);this._invalidList=!1}setupProgram(r){for(const e of this._setups)e.setup(r)}getCode(r){if(this._invalidList&&this._collectChunks(),this._cachedSlots===null||this._invalidCode){const e=new Yn;for(const s of this._codes)s.genCode(e);this._cachedSlots=e,this._invalidCode=!1}return r!==void 0?(r.merge(this._cachedSlots),r):this._cachedSlots}}class wr{constructor(r){this.name="",this.mask=-1,this.glconfig=new $n,this.inputs=new Dn,this._shaderSource=r}}const rr=1e-6,Cn=kn.create(),Rn=kn.create();function hn(n){return Math.abs(n)<rr}function er(n){return hn(n[0])&&hn(n[1])}function sr(n){return hn(n[0]-1)&&hn(n[1]-1)}const nn=new Float32Array(4);function ir(n,r,e,s){const i=Math.cos(e),t=Math.sin(e);n[0]=s[0]*i,n[1]=s[0]*-t,n[3]=s[1]*t,n[4]=s[1]*i,n[6]=r[0],n[7]=r[0],n[2]=0,n[5]=0,n[8]=0}const yn="aTexCoord0",en={declareIn(n){return`IN mediump vec2 ${n};`},declareOut(n){return`OUT mediump vec2 ${n};`},transformCode(n,r,e){let s=n.attrib;return e!==void 0&&(s=`mat2( ${e}() ) * ${s}`),r!==void 0&&(s=`${s} + ${r}()`),`${n.varying()} = ${s};`}};class tr{constructor(){this.buffer=new Float32Array(5),this.translation=new Float32Array(this.buffer.buffer,0,2),this.scale=new Float32Array(this.buffer.buffer,8,2),this.rotation=new Float32Array(this.buffer.buffer,16,1)}decomposeMatrix(r){this.translation[0]=r[6],this.translation[1]=r[7],this.scale[0]=Math.sqrt(r[0]*r[0]+r[1]*r[1]),this.scale[1]=Math.sqrt(r[3]*r[3]+r[4]*r[4]),this.rotation[0]=Math.atan2(r[1],r[0])}composeMat2(){const r=Math.cos(this.rotation[0]),e=Math.sin(this.rotation[0]);return nn[0]=this.scale[0]*r,nn[1]=this.scale[0]*-e,nn[2]=this.scale[1]*e,nn[3]=this.scale[1]*r,nn}getTransformHash(){return Jn(this.buffer)}}class ln extends B{constructor(r=yn,e){super(!0,e),this._uid="",this.attrib=r,this._transform=new tr}static create(r){return new pn(r,Rn)}static createTransformed(r,e=Rn){return new pn(r,e)}static createFromTRS(r,e={}){var s,i,t;const h=(s=e.translation)!==null&&s!==void 0?s:[0,0],c=(i=e.rotation)!==null&&i!==void 0?i:0,a=(t=e.scale)!==null&&t!==void 0?t:0;return ir(Cn,h,c,[a,a]),new pn(r,Cn)}static createTransformedDynamic(r){return new dn(r)}_genCode(r){r.add("pf",en.declareIn(this.varying())),r.add("pv",en.declareOut(this.varying())),r.add("pv",en.declareIn(this.attrib)),r.add("v",this.getTransformCode())}}class dn extends ln{constructor(r=yn){super(r,!0),this._uid=`${dn._UID++}`,this._translateInput=this.addChild(new V(`tct_t_${this._uid}`,2,V.VERTEX)),this._rotateScalesInput=this.addChild(new V(`tct_rs_${this._uid}`,4,V.VERTEX)),this._translateUniform=new W(`tct_ut_${this._uid}`,2),this._rotationScaleUniform=new W(`tct_urs_${this._uid}`,4),this._translateInput.attach(this._translateUniform),this._rotateScalesInput.attach(this._rotationScaleUniform)}varying(){return`vTexCoord_dtt${this._uid}`}getTransformCode(){return en.transformCode(this,this._translateInput.name,this._rotateScalesInput.name)}translate(r,e){return this._transform.translation[0]=r,this._transform.translation[1]=e,this.updateTransform(),this}rotate(r){return this._transform.rotation[0]=r,this.updateTransform(),this}scale(r,e=r){return this._transform.scale[0]=r,this._transform.scale[1]=e,this.updateTransform(),this}setMatrix(r){this._transform.decomposeMatrix(r),this.updateTransform()}updateTransform(){this._translateUniform.set(...this._transform.translation),this._rotationScaleUniform.set(...this._transform.composeMat2())}}dn._UID=0;class pn extends ln{constructor(r=yn,e){super(r,!1),this._transform.decomposeMatrix(e);const s=Mn(this._transform.getTransformHash());if(!er(this._transform.translation)){const i=new V(`tct_t_${s}`,2,V.VERTEX);this._translateInput=i,this._translateConst=i.attachConstant(this._transform.translation),this.addChild(i)}if(!sr(this._transform.scale)||!hn(this._transform.rotation[0])){const i=new V(`tct_rs_${s}`,4,V.VERTEX);this._rotateScalesInput=i,this._rotateScalesConst=i.attachConstant(this._transform.composeMat2()),this.addChild(i)}}varying(){const r=mn(fn(this.attrib),this._transform.getTransformHash());return`vTexCoord_${Mn(r)}`}getTransformCode(){var r,e;return en.transformCode(this,(r=this._translateInput)===null||r===void 0?void 0:r.name,(e=this._rotateScalesInput)===null||e===void 0?void 0:e.name)}}var b;(function(n){n.AUTO="auto",n.SRGB="srgb",n.LINEAR="linear"})(b||(b={}));b.SRGB,b.LINEAR;const xn=[null,"float","vec2","vec3","vec4"];var F;(function(n){n[n.FRAGMENT=1]="FRAGMENT",n[n.VERTEX=2]="VERTEX",n[n.ALL=3]="ALL"})(F||(F={}));function zn(n,r){const e=n.length;if(e===r)return n;if(e>r)return n.substr(0,r);const s=n[e-1];for(;n.length<r;)n=n+s;return n}function hr(n){return n.toPrecision(8)}function cr(n,r,e){r&F.FRAGMENT&&n.add("f",e),r&F.VERTEX&&n.add("v",e)}function cn(n,r,e){r&F.FRAGMENT&&n.add("pf",e),r&F.VERTEX&&n.add("pv",e)}var Z;(function(n){n[n.SAMPLER=0]="SAMPLER",n[n.UNIFORM=1]="UNIFORM",n[n.ATTRIBUTE=2]="ATTRIBUTE",n[n.CONSTANT=3]="CONSTANT"})(Z||(Z={}));class _n extends B{constructor(r=!1,e=!1){super(r,e),this._colorspace=b.AUTO}set colorspace(r){this._colorspace!==r&&(this._colorspace=r,this.invalidateCode())}get colorspace(){return this._colorspace}}class vn extends _n{constructor(r,e=ln.create(),s=b.AUTO){super(!0,!0),this.ptype=Z.SAMPLER,this.name=r,this._tex=null,this.size=4,this._colorspace=s,typeof e=="string"?(this.texCoords=e,this._varying=e):(this.texCoords=e,this.addChild(this.texCoords),this._varying=e.varying()),this.token=`VAL_${this.name}${this._varying}`}set(r){this._tex=r}_genCode(r){}genInputCode(r,e){let s;s=`uniform sampler2D ${this.name};
`,cn(r,e.shader,s),s=`vec4 ${this.token} = texture2D( ${this.name}, ${this._varying});
`,s+=vn.colorSpaceTransformCode(this._colorspace,e.colorspace,`${this.token}.rgb`),cr(r,e.shader,s)}setup(r){r[this.name](this._tex)}static colorSpaceTransformCode(r,e,s){return r===b.LINEAR&&e===b.SRGB?`${s} = sqrt(${s});`:r===b.SRGB&&e===b.LINEAR?`${s} = ${s}*${s};`:""}}class W extends _n{constructor(r,e){super(!0,!0),this.ptype=Z.UNIFORM,this.name=r,this.size=e,this._value=new Float32Array(e),this.token="VAL_"+this.name}get value(){return this._value}set x(r){this._value[0]=r}set y(r){this._value[1]=r}set z(r){this._value[2]=r}set w(r){this._value[3]=r}get x(){return this._value[0]}get y(){return this._value[1]}get z(){return this._value[2]}get w(){return this._value[3]}set(...r){for(var e=0;e<r.length;e++)this._value[e]=r[e];this._invalid=!0}_genCode(r){}genInputCode(r,e){let s=`uniform ${xn[this.size]} ${this.name};
`;s+=W.colorSpaceTransformCode(this._colorspace,e.colorspace,this.token,this.name),cn(r,e.shader,s)}setup(r){r[this.name](this._value),this._invalid=!1}static colorSpaceTransformCode(r,e,s,i){return r===b.LINEAR&&e===b.SRGB?`#define ${s} sqrt(${i})`:r===b.SRGB&&e===b.LINEAR?`#define ${s} (${i}*${i})`:`#define ${s} ${i}`}}class qn extends _n{constructor(r,e){super(!0,!1),this.ptype=Z.ATTRIBUTE,this.name=r,this.size=e,this.token=`v_${this.name}`}_genCode(r){}genInputCode(r,e){var s;const i=xn[this.size];s=`IN ${i} ${this.token};
`,r.add("pf",s),s=`IN ${i} ${this.name};
`,s+=`OUT ${i} ${this.token};
`,r.add("pv",s),s=`${this.token} = ${this.name};
`,r.add("v",s)}}class bn extends _n{constructor(r){super(!0,!1),this.ptype=Z.CONSTANT,this.name="",this.size=1,this.token="",this.value=0,this._hash=0,this.set(r)}set(r){typeof r=="number"?(this.size=1,this.value=r):(this.size=r.length,this.value=Array.from(r));const e=this._hash;this._hash=fn(`${this.size}-${this._stringifyValue()}`),this.name=`CONST_${Mn(this._hash)}`,this.token=`VAR_${this.name}`,e!==this._hash&&this.invalidateCode()}_genCode(r){}genInputCode(r,e){let s=`#define RAW_${this.token} ${xn[this.size]}(${this._stringifyValue()})
`;s+=W.colorSpaceTransformCode(this._colorspace,e.colorspace,this.token,"RAW_"+this.token),cn(r,e.shader,s)}_stringifyValue(){return this.size===1?this.value.toString():this.value.map(hr).join(",")}}class V extends B{constructor(r,e,s=F.FRAGMENT,i=b.LINEAR){super(!0,!1),this._colorspace=b.LINEAR,this.name=r,this.size=e,this.param=null,this.comps=zn("rgba",e),this.shader=s,this.colorspace=i}set colorspace(r){this._colorspace!==r&&(this._colorspace=r,this.invalidateCode())}get colorspace(){return this._colorspace}attach(r,e="rgba"){this.param&&this.removeChild(this.param),this.param=r,this.comps=zn(e,this.size),this.addChild(r)}detach(){this.param!==null&&this.removeChild(this.param),this.param=null}attachSampler(r=`T${this.name}`,e=ln.create(),s="rgba"){const i=new vn(r,e);return this.attach(i,s),i}attachUniform(r=`U${this.name}`,e=this.size,s="rgba"){const i=new W(r,e);return this.attach(i,s),i}attachAttribute(r=`A${this.name}`,e=this.size,s="rgba"){const i=new qn(r,e);return this.attach(i,s),i}attachConstant(r,e="rgba"){const s=new bn(r);return this.attach(s,e),s}_genCode(r){var e;(e=this.param)===null||e===void 0||e.genInputCode(r,this);const s=this.param===null?"0":"1",i=`#define HAS_${this.name} ${s}
`;if(r.add("definitions",i),this.param!==null){var t=`#define ${this.name}(k) ${this.param.token}`;if(this.param.size>1&&(t+=`.${this.comps}`),cn(r,this.shader,t),this.param.ptype===Z.SAMPLER){var t=`#define ${this.name}_texCoord(k) ${this.param._varying}`;cn(r,this.shader,t)}}}}V.Sampler=vn;V.Uniform=W;V.Attribute=qn;V.Constant=bn;V.FRAGMENT=F.FRAGMENT;V.VERTEX=F.VERTEX;V.ALL=F.ALL;const ar="#pragma SLOT",Tn=/^\s*#pragma SLOT\s\w+\s*$/gm;function fr(n){return new RegExp(`${ar}\\s+${n}\\s+`,"g")}function Sn(n,r){for(const{code:e,key:s}of r.slots)n=n.replace(fr(s),e);return Tn.lastIndex=0,n=n.replace(Tn,""),n}class wn{constructor(r){this.gl=r,this._cache={}}static getCache(r){const e=r;return e._prgcache===void 0&&(e._prgcache=new wn(r)),e._prgcache}compile(r){const e=fn(r.shaderSource.uid,r.slots.getHash()),s=this._cache[e];if(s!==void 0)return s;const i=Sn(r.shaderSource.vert,r.slots),t=Sn(r.shaderSource.frag,r.slots),h=new Vn(this.gl,i,t);return this._cache[e]=h,h}release(r){}}class lr{constructor(r,e){this._chunkCollections=[],this._program=null,this._revision=0,this._shaderSource=e,this._prgCache=wn.getCache(r)}addChunkCollection(r){this._chunkCollections.push(r)}getSourceRevision(){let r=0;for(const e of this._chunkCollections)r+=e.getRevision();return r}setupProgram(){const r=this.getProgram();r.use();for(const e of this._chunkCollections)e.setupProgram(r);return r}getProgram(){const r=this.getSourceRevision();return(this._program===null||this._revision!==r)&&(this.compile(),this._revision=r),this._program}compile(){const r=this._prgCache;this._program!==null&&r.release(this._program);const e=new Yn;for(const i of this._chunkCollections)i.getCode(e);const s={shaderSource:this._shaderSource,slots:e};this._program=r.compile(s)}}class dr{constructor(r,e){this._program=null,this.programSource=new lr(r.gl,e._shaderSource),this.programSource.addChunkCollection(r.inputs),this.programSource.addChunkCollection(e.inputs),this.pass=e,this.material=r}prepare(r,e){const s=this.programSource.setupProgram();return this.pass.prepare(s,r,e),s}getProgram(){return this.programSource.getProgram()}}class Ar{constructor(r,e=""){this.mask=-1,this.gl=r,this.name=e,this.glconfig=new $n,this.inputs=new Dn,this._passMap=new Map,this._passes=[]}addPass(r,e="color"){this._passMap.has(e)&&this.removePass(e);const s=new dr(this,r);return this._passMap.set(e,s),this._passes.push(s),s}removePass(r){if(this._passMap.has(r)){const e=this.getPass(r);this._passes.splice(this._passes.indexOf(e),1),this._passMap.delete(r)}}getPass(r="color"){return this._passMap.get(r)}hasPass(r){return this._passMap.has(r)}getAllPasses(){return this._passes}getProgram(r){const e=this.getPass(r);return e==null?void 0:e.getProgram()}}class or extends B{constructor(r,e=!1){super(!0,!1),this.name=r,this._val=!!e}enable(){this.set(!0)}disable(){this.set(!1)}set(r=!1){this._val!==r&&(this._val=r,this.invalidateCode())}get value(){return this._val}_genCode(r){const e=`#define ${this.name} ${~~this._val}`;r.add("definitions",e)}}const Cr=["OPAQUE","MASK","BLEND"];class Rr extends B{constructor(r="100"){super(!0,!1),this.version=r}set(r){this.version!==r&&(this.version=r,this.invalidateCode())}get(){return this.version}_genCode(r){var e=`#version ${this.version}`;r.add("version",e)}guessFromContext(r){this.set(Un(r)?"300 es":"100")}}export{Cr as A,b as C,pr as E,or as F,V as I,wr as M,xr as S,ln as T,W as U,yr as a,Ar as b,vn as c,B as d,kn as e,Rr as f,mr as g,F as h,gr as m,Mr as v};
