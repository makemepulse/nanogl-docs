import{C as B,P as z}from"./index-099e42fb.js";import{G as T,a as S}from"./indexbuffer-5b89fc58.js";import{_ as G}from"./web-7532ff8e.js";import{L as _,I as D}from"./Ibl-b0a560fd.js";import{iblSh as O,iblPath as y}from"./iblData-c6519b13.js";import{T as Y}from"./texture-2d-53b1df66.js";import{c as w,s as k,a as H,b as W}from"./vec3-33249e24.js";import{A as L}from"./common-a066d304.js";import"./arraybuffer-7f1df196.js";import"./ShaderVersion-75aae7d1.js";import"./Bounds-c261caf0.js";function I(){var o=new L(2);return L!=Float32Array&&(o[0]=0,o[1]=0),o}function U(o,a){var e=new L(2);return e[0]=o,e[1]=a,e}function V(o,a,e){return o[0]=a[0]-e[0],o[1]=a[1]-e[1],o}(function(){var o=I();return function(a,e,t,r,d,v){var i,c;for(e||(e=2),t||(t=0),r?c=Math.min(r*e+t,a.length):c=a.length,i=t;i<c;i+=e)o[0]=a[i],o[1]=a[i+1],d(o,o,v),a[i]=o[0],a[i+1]=o[1];return a}})();const ne=o=>{let a=!1;const e=o||document.getElementById("canvas"),t=e.getContext("webgl"),r={width:1,height:1},d=window.devicePixelRatio,v=([n])=>{const l=n.contentRect.width,m=n.contentRect.height;e.width=Math.round(l*d),e.height=Math.round(m*d),r.width=t.drawingBufferWidth,r.height=t.drawingBufferHeight},i=new ResizeObserver(v);i.observe(e);const c=T.get(t),E=new S().enableDepthTest().enableCullface().cullFace(t.BACK);c.push(E);const f=w(),s=new B(new z);s.lens.setAutoFov(35*(Math.PI/180)),s.lens.near=.01,s.lens.far=50,s.position.set([0,4,10]),s.lookAt(f);let b=!1,u=!1;const R=I(),F=n=>{if(b)console.log("Rotate",n);else if(u){const l=U(n.offsetX/100,n.offsetY/100),m=V(I(),l,R);R.set(l),s.position[0]-=m[0],s.position[1]+=m[1],f[0]-=m[0],f[1]+=m[1],s.invalidate()}};e.addEventListener("mousemove",F),e.addEventListener("contextmenu",n=>{n.preventDefault()}),e.addEventListener("mousedown",n=>{u=n.which===3,b=!u,R.set([n.offsetX/100,n.offsetY/100])}),e.addEventListener("mouseup",()=>{b=!1,u=!1}),e.addEventListener("wheel",n=>{n.preventDefault();const m=1+Math.min(Math.max(n.deltaY/100,-1),1)*.01,A=k(w(),H(w(),f,W(w(),s.position)),m);s.position.set(A),s.invalidate(),console.log(A[1])});const h=new _;h.bounds.fromMinMax([-1,-1,-1],[1,1,1]);const M=new Y(t,t.RGBA);M.clamp();const p=new D(M,O);p.iblFormat="OCTA",p.shFormat="SH9",p.hdrEncoding="RGBM";const C=new Image;C.src=y,C.onload=()=>{M.fromImage(C)},h.add(p);let g=null;G.loadGltf("../models/suzanne/Suzanne.gltf").then(async n=>{g=n,await g.allocate(t);for(const l of g.materials)l.materialPass.setLightSetup(h);a=!0,x()});let P=null;const x=(n=0)=>{if(a){t.viewport(0,0,r.width,r.height),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),c.apply(),s.updateWorldMatrix(),s.updateViewProjectionMatrix(r.width,r.height),h.prepare(t);for(const l of g.renderables)l.render(t,s,1,"color");P=window.requestAnimationFrame(x)}};return()=>{a=!1,window.cancelAnimationFrame(P),i.disconnect(),c.pop(),c.apply()}};export{ne as preview};
